<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.nt.service_pfans.PFANS1000.mapper.DepartmentalInsideMapper">
    <select id="getBaseInfo" resultType="com.nt.dao_Pfans.PFANS1000.Vo.DepartmentalInsideBaseVo">
        SELECT
            cpt.THEMEINFOR_ID,
            cpt.THEMENAME,
            cpt.DIVIDE,
            cpt.TOOLSORGS,
            cpt.GROUP_ID,
            cpt.CONTRACTNUMBER,
            cpt.CLAIMAMOUNT,
            cpt.ENTRYCONDITION,
            pt.CONTRACTAMOUNT AS CONTRACATAMOUNTDETAIL,
            cs.COMPANYPROJECTS_ID,
            cs.NUMBERS,
            pm.`NAME`,
            pm.RANK
        FROM
            (
            SELECT
            tr.THEMEINFOR_ID,
            tr.THEMENAME,
            tr.DIVIDE,
            tr.TOOLSORGS,
            cp.GROUP_ID,
            cp.CONTRACTNUMBER,
            cp.CLAIMAMOUNT,
            cp.ENTRYCONDITION,
            ct.CONTRACTNUMBERCOUNT_ID
            FROM
            themeinfor tr
            INNER JOIN contractapplication cp ON tr.THEMEINFOR_ID = cp.THEMEINFOR_ID
            INNER JOIN contractnumbercount ct ON cp.CONTRACTNUMBER = ct.CONTRACTNUMBER
            WHERE
            cp.`STATUS` != '1'
            AND tr.YEAR = #{YEAR}
            ) cpt
            LEFT JOIN projectcontract pt ON pt.CONTRACTNUMBERCOUNT_ID = cpt.CONTRACTNUMBERCOUNT_ID
            LEFT JOIN projectsystem pm ON pm.COMPANYPROJECTS_ID = pt.COMPANYPROJECTS_ID AND pm.type = '0'
            LEFT JOIN companyprojects cs ON cs.COMPANYPROJECTS_ID = pm.COMPANYPROJECTS_ID
            AND cs.`STATUS` >= 4
            order by cpt.CONTRACTNUMBER desc
    </select>
    <select id="getWorkInfo" parameterType="list" resultType="com.nt.dao_Pfans.PFANS1000.Vo.StaffWorkMonthInfoVo">
        SELECT
            a.rank,
            a.TYPE,
            a.group_id,
            a.project_id,
            sum( a.time_start ) time_start
        FROM
            (
            SELECT
                pm.RANK,
                pm.TYPE,
                cd.TIME_START,
                cd.GROUP_ID,
                cd.PROJECT_ID
            FROM
            (
            SELECT
                USER_ID AS userid,
                ROUND( ADJUST / my_WorkingDays ( DATE_FORMAT( concat( LOG_DATE, '-01' ), '%Y%m' ) ), 2 ) TIME_START,
                DEPARTMENT AS GROUP_ID,
                PROJECT_ID
            FROM
                logpersonstatistics lg
            WHERE
            DATE_FORMAT( concat( LOG_DATE, '-01' ), '%Y-%m' ) = #{LOG_DATE}
            AND PROJECT_ID != 'PP024001'
            AND PROJECT_ID IN
            <foreach collection="projectList" index="index" item="projectid" open="("
                     separator="," close=")">
                #{projectid}
            </foreach>
            GROUP BY
               LOG_DATE,
               USER_ID,
               ADJUST,
               GROUP_ID,
               PROJECT_ID
            ) cd
        INNER JOIN projectsystem pm ON pm.`NAME` = cd.userid
        AND pm.COMPANYPROJECTS_ID = cd.PROJECT_ID
        AND pm.type = '0'
        INNER JOIN companyprojects cs ON cs.COMPANYPROJECTS_ID = cd.PROJECT_ID
            UNION ALL
        SELECT
        p.RANK,
        p.TYPE,
        0 TIME_START,
        CASE
        WHEN c.CENTER_ID IN
        <foreach collection="departList" index="index" item="dep" open="("
                 separator="," close=")">
            #{dep}
        </foreach> THEN
        c.CENTER_ID ELSE c.GROUP_ID
        END,
        c.COMPANYPROJECTS_ID
        FROM
        projectsystem p
        INNER JOIN companyprojects c ON p.COMPANYPROJECTS_ID = c.COMPANYPROJECTS_ID
        AND p.type = '0'
        AND p.COMPANYPROJECTS_ID IN
        <foreach collection="projectList" index="index" item="projectid" open="("
                 separator="," close=")">
            #{projectid}
        </foreach>
        WHERE
        c.CENTER_ID IN
        <foreach collection="departList" index="index" item="dep" open="("
                 separator="," close=")">
            #{dep}
        </foreach>
        OR c.GROUP_ID IN
        <foreach collection="departList" index="index" item="dep" open="("
                 separator="," close=")">
            #{dep}
        </foreach>
            UNION ALL
        SELECT
        ade.ATTF,
        '' AS TYPE,
        0 TIME_START,
        ade.INCONDEPARTMENT,
        pc.COMPANYPROJECTS_ID
        FROM
        projectcontract pc
        INNER JOIN award ad ON pc.contract = ad.CONTRACTNUMBER
        AND pc.COMPANYPROJECTS_ID IN
        <foreach collection="projectList" index="index" item="projectid" open="("
                 separator="," close=")">
            #{projectid}
        </foreach>
        INNER JOIN staffdetail ade ON ade.AWARD_ID = ad.AWARD_ID
        ) a
        GROUP BY
        a.rank,
        a.TYPE,
        a.group_id,
        a.project_id
    </select>
    <insert id="insertDepInsAll" parameterType="java.util.List">
        insert into DepartmentalInside
        (
        DEPARTMENTALINSIDE_ID
        ,YEARS
        ,DEPARTMENT
        ,THEMEINFOR_ID
        ,THEMENAME
        ,DIVIDE
        ,TOOLSORGS
        ,CONTRACTNUMBER
        ,CLAIMAMOUNT
        ,CONTRACATAMOUNTDETAIL
        ,CLAIMTYPE
        ,ENTRYCONDITION
        ,PROJECT_ID
        ,NUMBERS
        ,STAFFRANK
        ,STAFFCUSTPLAN04
        ,STAFFCUSTACTUAL04
        ,STAFFCUSTPLAN05
        ,STAFFCUSTACTUAL05
        ,STAFFCUSTPLAN06
        ,STAFFCUSTACTUAL06
        ,WORKDIFFERENTFIRST
        ,RANKDIFFERENTFIRST
        ,STAFFCUSTPLAN07
        ,STAFFCUSTACTUAL07
        ,STAFFCUSTPLAN08
        ,STAFFCUSTACTUAL08
        ,STAFFCUSTPLAN09
        ,STAFFCUSTACTUAL09
        ,WORKDIFFERENTSECOND
        ,RANKDIFFERENTSECOND
        ,STAFFCUSTPLAN10
        ,STAFFCUSTACTUAL10
        ,STAFFCUSTPLAN11
        ,STAFFCUSTACTUAL11
        ,STAFFCUSTPLAN12
        ,STAFFCUSTACTUAL12
        ,WORKDIFFERENTTHIRD
        ,RANKDIFFERENTTHIRD
        ,STAFFCUSTPLAN01
        ,STAFFCUSTACTUAL01
        ,STAFFCUSTPLAN02
        ,STAFFCUSTACTUAL02
        ,STAFFCUSTPLAN03
        ,STAFFCUSTACTUAL03
        ,WORKDIFFERENTFOURTH
        ,RANKDIFFERENTFOURTH
        ,WORKDIFFERENTOFYEAR
        ,RANKDIFFERENTOFYEAR
        ,CREATEBY
        ,CREATEON
        ,MODIFYBY
        ,MODIFYON
        ,OWNER
        ,STATUS
        ,TENANTID
        )
        values
        <foreach item="item" collection="list" separator=",">
            (
            #{item.departmentalinside_id},
            #{item.years},
            #{item.department},
            #{item.themeinfor_id},
            #{item.themename},
            #{item.divide},
            #{item.toolsorgs},
            #{item.contractnumber},
            #{item.claimamount},
            #{item.contracatamountdetail},
            #{item.claimtype},
            #{item.entrycondition},
            #{item.project_id},
            #{item.numbers},
            #{item.staffrank},
            #{item.staffcustplan04},
            #{item.staffcustactual04},
            #{item.staffcustplan05},
            #{item.staffcustactual05},
            #{item.staffcustplan06},
            #{item.staffcustactual06},
            #{item.workdifferentfirst},
            #{item.rankdifferentfirst},
            #{item.staffcustplan07},
            #{item.staffcustactual07},
            #{item.staffcustplan08},
            #{item.staffcustactual08},
            #{item.staffcustplan09},
            #{item.staffcustactual09},
            #{item.workdifferentsecond},
            #{item.rankdifferentsecond},
            #{item.staffcustplan10},
            #{item.staffcustactual10},
            #{item.staffcustplan11},
            #{item.staffcustactual11},
            #{item.staffcustplan12},
            #{item.staffcustactual12},
            #{item.workdifferentthird},
            #{item.rankdifferentthird},
            #{item.staffcustplan01},
            #{item.staffcustactual01},
            #{item.staffcustplan02},
            #{item.staffcustactual02},
            #{item.staffcustplan03},
            #{item.staffcustactual03},
            #{item.workdifferentfourth},
            #{item.rankdifferentfourth},
            #{item.workdifferentofyear},
            #{item.rankdifferentofyear},
            #{item.createby},
            #{item.createon},
            #{item.modifyby},
            #{item.modifyon},
            #{item.owner},
            #{item.status},
            #{item.tenantid}
            )
        </foreach>
    </insert>
    <update id="updateDepInsAll" parameterType="java.util.List">
        <foreach item="item" collection="list" index="index">
            UPDATE DepartmentalInside
            SET
            STAFFCUSTPLAN04       	= #{item.staffcustplan04},
            STAFFCUSTACTUAL04     	= #{item.staffcustactual04},
            STAFFCUSTPLAN05       	= #{item.staffcustplan05},
            STAFFCUSTACTUAL05     	= #{item.staffcustactual05},
            STAFFCUSTPLAN06       	= #{item.staffcustplan06},
            STAFFCUSTACTUAL06     	= #{item.staffcustactual06},
            WORKDIFFERENTFIRST    	= #{item.workdifferentfirst},
            RANKDIFFERENTFIRST      = #{item.rankdifferentfirst},
            STAFFCUSTPLAN07       	= #{item.staffcustplan07},
            STAFFCUSTACTUAL07     	= #{item.staffcustactual07},
            STAFFCUSTPLAN08       	= #{item.staffcustplan08},
            STAFFCUSTACTUAL08     	= #{item.staffcustactual08},
            STAFFCUSTPLAN09       	= #{item.staffcustplan09},
            STAFFCUSTACTUAL09     	= #{item.staffcustactual09},
            WORKDIFFERENTSECOND    	= #{item.workdifferentsecond},
            RANKDIFFERENTSECOND     = #{item.rankdifferentsecond},
            STAFFCUSTPLAN10       	= #{item.staffcustplan10},
            STAFFCUSTACTUAL10     	= #{item.staffcustactual10},
            STAFFCUSTPLAN11       	= #{item.staffcustplan11},
            STAFFCUSTACTUAL11     	= #{item.staffcustactual11},
            STAFFCUSTPLAN12       	= #{item.staffcustplan12},
            STAFFCUSTACTUAL12     	= #{item.staffcustactual12},
            WORKDIFFERENTTHIRD    	= #{item.workdifferentthird},
            RANKDIFFERENTTHIRD      = #{item.rankdifferentthird},
            STAFFCUSTPLAN01       	= #{item.staffcustplan01},
            STAFFCUSTACTUAL01     	= #{item.staffcustactual01},
            STAFFCUSTPLAN02       	= #{item.staffcustplan02},
            STAFFCUSTACTUAL02     	= #{item.staffcustactual02},
            STAFFCUSTPLAN03       	= #{item.staffcustplan03},
            STAFFCUSTACTUAL03     	= #{item.staffcustactual03},
            WORKDIFFERENTFOURTH    	= #{item.workdifferentfourth},
            RANKDIFFERENTFOURTH     = #{item.rankdifferentfourth},
            WORKDIFFERENTOFYEAR     = #{item.workdifferentofyear},
            RANKDIFFERENTOFYEAR     = #{item.rankdifferentofyear},
            CREATEBY            = #{item.createby},
            CREATEON            = #{item.createon},
            MODIFYBY            = #{item.modifyby},
            MODIFYON            = #{item.modifyon},
            OWNER               = #{item.owner},
            STATUS              = #{item.status},
            TENANTID            = #{item.tenantid}
            WHERE DEPARTMENTALINSIDE_ID = #{item.departmentalinside_id};
        </foreach>
    </update>
    <select id="getContList" resultType="com.nt.dao_Pfans.PFANS1000.Vo.ThemeContract">
        SELECT
            ATT.CONTRACTNUMBER,
            ATT.CONTRACTNUMBERCON,
            ATT.COMPLETIONDATE,
            ATT.CLAIMAMOUNT,
            MON.EXCHANGERATE AS CURRENCYPOSITION
        FROM
            (SELECT
                 CONTRACTNUMBER,
                 CONCAT(CONTRACTNUMBER, "-", CLAIMTYPE) AS CONTRACTNUMBERCON,
                 COMPLETIONDATE,
                 CLAIMAMOUNT
             FROM
                 CONTRACTNUMBERCOUNT
             WHERE
                     CONTRACTNUMBER IN (
                         SELECT CONTRACTNUMBER FROM DEPARTMENTALINSIDE
                         WHERE YEARS = #{years} AND DEPARTMENT = #{depart} GROUP BY CONTRACTNUMBER )
               AND COMPLETIONDATE >= DATE_FORMAT( CONCAT( #{yearmonth}, '-01' ), '%Y-%m-%d' )
            )
                ATT LEFT JOIN CONTRACTAPPLICATION CAN ON ATT.CONTRACTNUMBER = CAN.CONTRACTNUMBER
                    LEFT JOIN monthlyrate MON ON MON.MONTH = #{yearmonth} AND CAN.CURRENCYPOSITION  = MON.CURRENCY
        ORDER BY
            ATT.CONTRACTNUMBER
    </select>

    <select id="getContListAnt" resultType="com.nt.dao_Pfans.PFANS1000.Vo.ThemeContract">
        SELECT
            ATT.CONTRACTNUMBER,
            ATT.CONTRACTNUMBERCON,
            ATT.COMPLETIONDATE,
            ATT.CLAIMAMOUNT,
            MON.EXCHANGERATE AS CURRENCYPOSITION
        FROM
            (SELECT
                 CONTRACTNUMBER,
                 CONCAT(CONTRACTNUMBER, "-", CLAIMTYPE) AS CONTRACTNUMBERCON,
                 COMPLETIONDATE,
                 CLAIMAMOUNT
             FROM
                 CONTRACTNUMBERCOUNT
             WHERE
                     CONTRACTNUMBER IN (
                     SELECT CONTRACTNUMBER FROM DEPARTMENTALINSIDE
                     WHERE YEARS = #{years} AND DEPARTMENT = #{depart} GROUP BY CONTRACTNUMBER )
               AND COMPLETIONDATE &lt; DATE_FORMAT( CONCAT( #{yearmonth}, '-01' ), '%Y-%m-%d' ))
                ATT LEFT JOIN CONTRACTAPPLICATION CAN ON ATT.CONTRACTNUMBER = CAN.CONTRACTNUMBER
                  LEFT JOIN monthlyrate MON ON MON.MONTH = #{yearmonth} AND CAN.CURRENCYPOSITION  = MON.CURRENCY
        ORDER BY
            ATT.CONTRACTNUMBER
    </select>

    <select id="getComm" resultType="com.nt.dao_Pfans.PFANS1000.Vo.DepartMonthPeo">
        SELECT
            (
                SELECT
                    ROUND( sum( ADJUST / my_WorkingDays ( DATE_FORMAT( concat( LOG_DATE, '-01' ), '%Y%m' ) ) ), 2 ) TIME_START
                FROM
                    logpersonstatistics lg
                WHERE
                    LOG_DATE = concat( CONVERT( #{LOG_DATE}, SIGNED) + 1, '-', '01' )
                  AND PROJECT_ID = 'PP024001'
                  AND DEPARTMENT = #{depart}
            ) AS month01,
            (
                SELECT
                    ROUND( sum( ADJUST / my_WorkingDays ( DATE_FORMAT( concat( LOG_DATE, '-01' ), '%Y%m' ) ) ), 2 ) TIME_START
                FROM
                    logpersonstatistics lg
                WHERE
                    LOG_DATE = concat( CONVERT( #{LOG_DATE}, SIGNED) + 1, '-', '02' )
                  AND PROJECT_ID = 'PP024001'
                  AND DEPARTMENT = #{depart}
            ) AS month02,
            (
                SELECT
                    ROUND( sum( ADJUST / my_WorkingDays ( DATE_FORMAT( concat( LOG_DATE, '-01' ), '%Y%m' ) ) ), 2 ) TIME_START
                FROM
                    logpersonstatistics lg
                WHERE
                    LOG_DATE = concat( CONVERT( #{LOG_DATE}, SIGNED) + 1, '-', '03' )
                  AND PROJECT_ID = 'PP024001'
                  AND DEPARTMENT = #{depart}
            ) AS month03,
            (
                SELECT
                    ROUND( sum( ADJUST / my_WorkingDays ( DATE_FORMAT( concat( LOG_DATE, '-01' ), '%Y%m' ) ) ), 2 ) TIME_START
                FROM
                    logpersonstatistics lg
                WHERE
                    LOG_DATE = concat( #{LOG_DATE}, '-', '04' )
                  AND PROJECT_ID = 'PP024001'
                  AND DEPARTMENT = #{depart}
            ) AS month04,
            (
                SELECT
                    ROUND( sum( ADJUST / my_WorkingDays ( DATE_FORMAT( concat( LOG_DATE, '-01' ), '%Y%m' ) ) ), 2 ) TIME_START
                FROM
                    logpersonstatistics lg
                WHERE
                    LOG_DATE = concat( #{LOG_DATE}, '-', '05' )
                  AND PROJECT_ID = 'PP024001'
                  AND DEPARTMENT = #{depart}
            ) AS month05,
            (
                SELECT
                    ROUND( sum( ADJUST / my_WorkingDays ( DATE_FORMAT( concat( LOG_DATE, '-01' ), '%Y%m' ) ) ), 2 ) TIME_START
                FROM
                    logpersonstatistics lg
                WHERE
                    LOG_DATE = concat( #{LOG_DATE}, '-', '06' )
                  AND PROJECT_ID = 'PP024001'
                  AND DEPARTMENT = #{depart}
            ) AS month06,
            (
                SELECT
                    ROUND( sum( ADJUST / my_WorkingDays ( DATE_FORMAT( concat( LOG_DATE, '-01' ), '%Y%m' ) ) ), 2 ) TIME_START
                FROM
                    logpersonstatistics lg
                WHERE
                    LOG_DATE = concat( #{LOG_DATE}, '-', '07' )
                  AND PROJECT_ID = 'PP024001'
                  AND DEPARTMENT = #{depart}
            ) AS month07,
            (
                SELECT
                    ROUND( sum( ADJUST / my_WorkingDays ( DATE_FORMAT( concat( LOG_DATE, '-01' ), '%Y%m' ) ) ), 2 ) TIME_START
                FROM
                    logpersonstatistics lg
                WHERE
                    LOG_DATE = concat( #{LOG_DATE}, '-', '08' )
                  AND PROJECT_ID = 'PP024001'
                  AND DEPARTMENT = #{depart}
            ) AS month08,
            (
                SELECT
                    ROUND( sum( ADJUST / my_WorkingDays ( DATE_FORMAT( concat( LOG_DATE, '-01' ), '%Y%m' ) ) ), 2 ) TIME_START
                FROM
                    logpersonstatistics lg
                WHERE
                    LOG_DATE = concat( #{LOG_DATE}, '-', '09' )
                  AND PROJECT_ID = 'PP024001'
                  AND DEPARTMENT = #{depart}
            ) AS month09,
            (
                SELECT
                    ROUND( sum( ADJUST / my_WorkingDays ( DATE_FORMAT( concat( LOG_DATE, '-01' ), '%Y%m' ) ) ), 2 ) TIME_START
                FROM
                    logpersonstatistics lg
                WHERE
                    LOG_DATE = concat( #{LOG_DATE}, '-', '10' )
                  AND PROJECT_ID = 'PP024001'
                  AND DEPARTMENT = #{depart}
            ) AS month10,
            (
                SELECT
                    ROUND( sum( ADJUST / my_WorkingDays ( DATE_FORMAT( concat( LOG_DATE, '-01' ), '%Y%m' ) ) ), 2 ) TIME_START
                FROM
                    logpersonstatistics lg
                WHERE
                    LOG_DATE = concat( #{LOG_DATE}, '-', '11' )
                  AND PROJECT_ID = 'PP024001'
                  AND DEPARTMENT = #{depart}
            ) AS month11,
            (
                SELECT
                    ROUND( sum( ADJUST / my_WorkingDays ( DATE_FORMAT( concat( LOG_DATE, '-01' ), '%Y%m' ) ) ), 2 ) TIME_START
                FROM
                    logpersonstatistics lg
                WHERE
                    LOG_DATE = concat( #{LOG_DATE}, '-', '12' )
                  AND PROJECT_ID = 'PP024001'
                  AND DEPARTMENT = #{depart}
            ) AS month12
    </select>

    <select id="getTotalPeo" parameterType="java.lang.String" resultType="com.nt.dao_Pfans.PFANS1000.Vo.DepartMonthPeo">
        SELECT
            (SELECT count( 1 ) AS month01 FROM(
                                                  SELECT
                                                      count( * )
                                                  FROM
                                                      attendance
                                                  WHERE
                                                          years = CONVERT( #{years}, SIGNED) + 1
                                                          AND MONTHS = '01'
                                                          AND CENTER_ID = #{departmental}
                                                     OR GROUP_ID = #{departmental}
                                                  GROUP BY
                                                      USER_ID
                                              ) as month01)
                AS month01,
            (
                SELECT count( 1 ) AS month02 FROM(
                                                     SELECT
                                                         count( * )
                                                     FROM
                                                         attendance
                                                     WHERE
                                                             years = CONVERT( #{years}, SIGNED) + 1
                                                             AND MONTHS = '02'
                                                             AND CENTER_ID = #{departmental}
                                                        OR GROUP_ID = #{departmental}
                                                     GROUP BY
                                                         USER_ID
                                                 ) as month02
            )
                AS month02,
            (
                SELECT count( 1 ) AS month03 FROM(
                                                     SELECT
                                                         count( * )
                                                     FROM
                                                         attendance
                                                     WHERE
                                                             years = CONVERT( #{years}, SIGNED) + 1
                                                             AND MONTHS = '03'
                                                             AND CENTER_ID = #{departmental}
                                                        OR GROUP_ID = #{departmental}
                                                     GROUP BY
                                                         USER_ID
                                                 ) as month03
            )
                AS month03,
            (
                SELECT count( 1 ) AS month04 FROM(
                                                     SELECT
                                                         count( * )
                                                     FROM
                                                         attendance
                                                     WHERE
                                                             years = #{years}
                                                             AND MONTHS = '04'
                                                             AND CENTER_ID = #{departmental}
                                                        OR GROUP_ID = #{departmental}
                                                     GROUP BY
                                                         USER_ID
                                                 ) as month04
            )
                AS month04,
            (
                SELECT count( 1 ) AS month05 FROM(
                                                     SELECT
                                                         count( * )
                                                     FROM
                                                         attendance
                                                     WHERE
                                                             years = #{years}
                                                             AND MONTHS = '05'
                                                             AND CENTER_ID = #{departmental}
                                                        OR GROUP_ID = #{departmental}
                                                     GROUP BY
                                                         USER_ID
                                                 ) as month05
            )
                AS month05,
            (
                SELECT count( 1 ) AS month06 FROM(
                                                     SELECT
                                                         count( * )
                                                     FROM
                                                         attendance
                                                     WHERE
                                                             years = #{years}
                                                             AND MONTHS = '06'
                                                             AND CENTER_ID = #{departmental}
                                                        OR GROUP_ID = #{departmental}
                                                     GROUP BY
                                                         USER_ID
                                                 ) as month06
            )
                AS month06,
            (
                SELECT count( 1 ) AS month07 FROM(
                                                     SELECT
                                                         count( * )
                                                     FROM
                                                         attendance
                                                     WHERE
                                                             years = #{years}
                                                             AND MONTHS = '07'
                                                             AND CENTER_ID = #{departmental}
                                                        OR GROUP_ID = #{departmental}
                                                     GROUP BY
                                                         USER_ID
                                                 ) as month07
            )
                AS month07,
            (
                SELECT count( 1 ) AS month08 FROM(
                                                     SELECT
                                                         count( * )
                                                     FROM
                                                         attendance
                                                     WHERE
                                                             years = #{years}
                                                             AND MONTHS = '08'
                                                             AND CENTER_ID = #{departmental}
                                                        OR GROUP_ID = #{departmental}
                                                     GROUP BY
                                                         USER_ID
                                                 ) as month08
            )
                AS month08,
            (
                SELECT count( 1 ) AS month09 FROM(
                                                     SELECT
                                                         count( * )
                                                     FROM
                                                         attendance
                                                     WHERE
                                                             years = #{years}
                                                             AND MONTHS = '09'
                                                             AND CENTER_ID = #{departmental}
                                                        OR GROUP_ID = #{departmental}
                                                     GROUP BY
                                                         USER_ID
                                                 ) as month09
            )
                AS month09,
            (
                SELECT count( 1 ) AS month10 FROM(
                                                     SELECT
                                                         count( * )
                                                     FROM
                                                         attendance
                                                     WHERE
                                                             years = #{years}
                                                             AND MONTHS = '10'
                                                             AND CENTER_ID = #{departmental}
                                                        OR GROUP_ID = #{departmental}
                                                     GROUP BY
                                                         USER_ID
                                                 ) as month10
            )
                AS month10,
            (
                SELECT count( 1 ) AS month11 FROM(
                                                     SELECT
                                                         count( * )
                                                     FROM
                                                         attendance
                                                     WHERE
                                                             years = #{years}
                                                             AND MONTHS = '11'
                                                             AND CENTER_ID = #{departmental}
                                                        OR GROUP_ID = #{departmental}
                                                     GROUP BY
                                                         USER_ID
                                                 ) as month11
            )
                AS month11,
            (
                SELECT count( 1 ) AS month12 FROM(
                                                     SELECT
                                                         count( * )
                                                     FROM
                                                         attendance
                                                     WHERE
                                                             years = #{years}
                                                             AND MONTHS = '12'
                                                             AND CENTER_ID = #{departmental}
                                                        OR GROUP_ID = #{departmental}
                                                     GROUP BY
                                                         USER_ID
                                                 ) as month12
            )
                AS month12
    </select>

    <select id="sumContractIn" parameterType="String" resultType="com.nt.dao_Pfans.PFANS1000.Vo.ThemeContract">
        SELECT
            round( sum( staffcustactual01 ), 2 ) AS actual01,
            round( sum( staffcustactual02 ), 2 ) AS actual02,
            round( sum( staffcustactual03 ), 2 ) AS actual03,
            round( sum( staffcustactual04 ), 2 ) AS actual04,
            round( sum( staffcustactual05 ), 2 ) AS actual05,
            round( sum( staffcustactual06 ), 2 ) AS actual06,
            round( sum( staffcustactual07 ), 2 ) AS actual07,
            round( sum( staffcustactual08 ), 2 ) AS actual08,
            round( sum( staffcustactual09 ), 2 ) AS actual09,
            round( sum( staffcustactual10 ), 2 ) AS actual10,
            round( sum( staffcustactual11 ), 2 ) AS actual11,
            round( sum( staffcustactual12 ), 2 ) AS actual12
        FROM
            departmentalinside
        WHERE
            CONTRACTNUMBER = #{conber}
          AND years = #{years}
          AND DEPARTMENT = #{departmental}
          AND STAFFRANK != '外注工数合计值'
          AND STAFFRANK != '外注费用合计值'
    </select>

    <select id="sumContractOut" parameterType="String" resultType="com.nt.dao_Pfans.PFANS1000.Vo.ThemeContract">
        SELECT
            round( sum( staffcustactual01 ), 2 ) AS actual01,
            round( sum( staffcustactual02 ), 2 ) AS actual02,
            round( sum( staffcustactual03 ), 2 ) AS actual03,
            round( sum( staffcustactual04 ), 2 ) AS actual04,
            round( sum( staffcustactual05 ), 2 ) AS actual05,
            round( sum( staffcustactual06 ), 2 ) AS actual06,
            round( sum( staffcustactual07 ), 2 ) AS actual07,
            round( sum( staffcustactual08 ), 2 ) AS actual08,
            round( sum( staffcustactual09 ), 2 ) AS actual09,
            round( sum( staffcustactual10 ), 2 ) AS actual10,
            round( sum( staffcustactual11 ), 2 ) AS actual11,
            round( sum( staffcustactual12 ), 2 ) AS actual12
        FROM
            departmentalinside
        WHERE
            CONTRACTNUMBER = #{conber}
          AND years = #{years}
          AND DEPARTMENT = #{departmental}
          AND STAFFRANK = '外注工数合计值'
    </select>
</mapper>
