<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.nt.service_pfans.PFANS2000.mapper.ComprehensiveMapper">
    <select id="getcomprehensive" parameterType="com.nt.dao_Pfans.PFANS2000.Base"
            resultType="com.nt.dao_Pfans.PFANS2000.Vo.ComprehensiveVo">
		SELECT
			USER_ID,
			TOTALBONUS1,
			month1wages,
			month1appreciation,
			month2wages,
			month2appreciation,
			month3wages,
			month3appreciation,
			month4wages,
			month4appreciation,
			month5wages,
			month5appreciation,
			month6wages,
			month6appreciation,
			month7wages,
			month7appreciation,
			month8wages,
			month8appreciation,
			month9wages,
			month9appreciation,
			month10wages,
			month10appreciation,
			month11wages,
			month11appreciation,
			month12wages,
			month12appreciation,
		IFNULL(month1appreciation,0) + IFNULL(month2appreciation,0) + IFNULL(month3appreciation,0) + IFNULL(month4appreciation,0) + IFNULL(month5appreciation,0) + IFNULL(month6appreciation,0) + IFNULL(month7appreciation,0) + IFNULL(month8appreciation,0) + IFNULL(month9appreciation,0) + IFNULL(month10appreciation,0) + IFNULL(month11appreciation,0) + IFNULL(month12appreciation,0) AS appreciationtotal,
		IFNULL(month1wages,0) + IFNULL(month2wages,0) + IFNULL(month3wages,0) + IFNULL(month4wages,0) + IFNULL(month5wages,0) + IFNULL(month6wages,0) + IFNULL(month7wages,0) + IFNULL(month8wages,0) + IFNULL(month9wages,0) + IFNULL(month10wages,0) + IFNULL(month11wages,0) + IFNULL(month1appreciation,0) + IFNULL(month2appreciation,0) + IFNULL(month3appreciation,0) + IFNULL(month4appreciation,0) + IFNULL(month5appreciation,0) + IFNULL(month6appreciation,0) + IFNULL(month7appreciation,0) + IFNULL(month8appreciation,0) + IFNULL(month9appreciation,0) + IFNULL(month10appreciation,0) + IFNULL(month11appreciation,0) AS totalwithout12,
		IFNULL(month1wages,0) + IFNULL(month2wages,0) + IFNULL(month3wages,0) + IFNULL(month4wages,0) + IFNULL(month5wages,0) + IFNULL(month6wages,0) + IFNULL(month7wages,0) + IFNULL(month8wages,0) + IFNULL(month9wages,0) + IFNULL(month10wages,0) + IFNULL(month11wages,0) + IFNULL(month12wages,0) + IFNULL(month1appreciation,0) + IFNULL(month2appreciation,0) + IFNULL(month3appreciation,0) + IFNULL(month4appreciation,0) + IFNULL(month5appreciation,0) + IFNULL(month6appreciation,0) + IFNULL(month7appreciation,0) + IFNULL(month8appreciation,0) + IFNULL(month9appreciation,0) + IFNULL(month10appreciation,0) + IFNULL(month11appreciation,0) + IFNULL(month12appreciation,0) AS totalwithin12
		FROM
			(
			SELECT
				base.USER_ID,
				IFNULL( sum( bonussend.TOTALBONUS1 ), 0 ) TOTALBONUS1,
				MAX( CASE DATE_FORMAT( wages.CREATEON, '%Y%m' ) WHEN CONCAT( YEAR ( SYSDATE( ) ), '01' ) THEN IFNULL(SHOULDWAGES,0) ELSE 0 END ) month1wages,
				MAX( CASE DATE_FORMAT( wages.CREATEON, '%Y%m' ) WHEN CONCAT( YEAR ( SYSDATE( ) ), '01' ) THEN IFNULL(APPRECIATION,0) ELSE 0 END ) month1appreciation,
				MAX( CASE DATE_FORMAT( wages.CREATEON, '%Y%m' ) WHEN CONCAT( YEAR ( SYSDATE( ) ), '02' ) THEN IFNULL(SHOULDWAGES,0) ELSE 0 END ) month2wages,
				MAX( CASE DATE_FORMAT( wages.CREATEON, '%Y%m' ) WHEN CONCAT( YEAR ( SYSDATE( ) ), '02' ) THEN IFNULL(APPRECIATION,0) ELSE 0 END ) month2appreciation,
				MAX( CASE DATE_FORMAT( wages.CREATEON, '%Y%m' ) WHEN CONCAT( YEAR ( SYSDATE( ) ), '03' ) THEN IFNULL(SHOULDWAGES,0) ELSE 0 END ) month3wages,
				MAX( CASE DATE_FORMAT( wages.CREATEON, '%Y%m' ) WHEN CONCAT( YEAR ( SYSDATE( ) ), '03' ) THEN IFNULL(APPRECIATION,0) ELSE 0 END ) month3appreciation,
				MAX( CASE DATE_FORMAT( wages.CREATEON, '%Y%m' ) WHEN CONCAT( YEAR ( SYSDATE( ) ), '04' ) THEN IFNULL(SHOULDWAGES,0) ELSE 0 END ) month4wages,
				MAX( CASE DATE_FORMAT( wages.CREATEON, '%Y%m' ) WHEN CONCAT( YEAR ( SYSDATE( ) ), '04' ) THEN IFNULL(APPRECIATION,0) ELSE 0 END ) month4appreciation,
				MAX( CASE DATE_FORMAT( wages.CREATEON, '%Y%m' ) WHEN CONCAT( YEAR ( SYSDATE( ) ), '05' ) THEN IFNULL(SHOULDWAGES,0) ELSE 0 END ) month5wages,
				MAX( CASE DATE_FORMAT( wages.CREATEON, '%Y%m' ) WHEN CONCAT( YEAR ( SYSDATE( ) ), '05' ) THEN IFNULL(APPRECIATION,0) ELSE 0 END ) month5appreciation,
				MAX( CASE DATE_FORMAT( wages.CREATEON, '%Y%m' ) WHEN CONCAT( YEAR ( SYSDATE( ) ), '06' ) THEN IFNULL(SHOULDWAGES,0) ELSE 0 END ) month6wages,
				MAX( CASE DATE_FORMAT( wages.CREATEON, '%Y%m' ) WHEN CONCAT( YEAR ( SYSDATE( ) ), '06' ) THEN IFNULL(APPRECIATION,0) ELSE 0 END ) month6appreciation,
				MAX( CASE DATE_FORMAT( wages.CREATEON, '%Y%m' ) WHEN CONCAT( YEAR ( SYSDATE( ) ), '07' ) THEN IFNULL(SHOULDWAGES,0) ELSE 0 END ) month7wages,
				MAX( CASE DATE_FORMAT( wages.CREATEON, '%Y%m' ) WHEN CONCAT( YEAR ( SYSDATE( ) ), '07' ) THEN IFNULL(APPRECIATION,0) ELSE 0 END ) month7appreciation,
				MAX( CASE DATE_FORMAT( wages.CREATEON, '%Y%m' ) WHEN CONCAT( YEAR ( SYSDATE( ) ), '08' ) THEN IFNULL(SHOULDWAGES,0) ELSE 0 END ) month8wages,
				MAX( CASE DATE_FORMAT( wages.CREATEON, '%Y%m' ) WHEN CONCAT( YEAR ( SYSDATE( ) ), '08' ) THEN IFNULL(APPRECIATION,0) ELSE 0 END ) month8appreciation,
				MAX( CASE DATE_FORMAT( wages.CREATEON, '%Y%m' ) WHEN CONCAT( YEAR ( SYSDATE( ) ), '09' ) THEN IFNULL(SHOULDWAGES,0) ELSE 0 END ) month9wages,
				MAX( CASE DATE_FORMAT( wages.CREATEON, '%Y%m' ) WHEN CONCAT( YEAR ( SYSDATE( ) ), '09' ) THEN IFNULL(APPRECIATION,0) ELSE 0 END ) month9appreciation,
				MAX( CASE DATE_FORMAT( wages.CREATEON, '%Y%m' ) WHEN CONCAT( YEAR ( SYSDATE( ) ), '10' ) THEN IFNULL(SHOULDWAGES,0) ELSE 0 END ) month10wages,
				MAX( CASE DATE_FORMAT( wages.CREATEON, '%Y%m' ) WHEN CONCAT( YEAR ( SYSDATE( ) ), '10' ) THEN IFNULL(APPRECIATION,0) ELSE 0 END ) month10appreciation,
				MAX( CASE DATE_FORMAT( wages.CREATEON, '%Y%m' ) WHEN CONCAT( YEAR ( SYSDATE( ) ), '11' ) THEN IFNULL(SHOULDWAGES,0) ELSE 0 END ) month11wages,
				MAX( CASE DATE_FORMAT( wages.CREATEON, '%Y%m' ) WHEN CONCAT( YEAR ( SYSDATE( ) ), '11' ) THEN IFNULL(APPRECIATION,0) ELSE 0 END ) month11appreciation,
				MAX( CASE DATE_FORMAT( wages.CREATEON, '%Y%m' ) WHEN CONCAT( YEAR ( SYSDATE( ) ), '12' ) THEN IFNULL(SHOULDWAGES,0) ELSE 0 END ) month12wages,
				MAX( CASE DATE_FORMAT( wages.CREATEON, '%Y%m' ) WHEN CONCAT( YEAR ( SYSDATE( ) ), '12' ) THEN IFNULL(APPRECIATION,0) ELSE 0 END ) month12appreciation
			FROM
				base
				LEFT JOIN wages ON base.USER_ID = wages.USER_ID
				AND IFNULL( wages.STATUS, '0' ) = '0'
				LEFT JOIN bonussend ON base.USER_ID = bonussend.USER_ID
				AND bonussend.years = YEAR (
				SYSDATE())
				AND ( bonussend.METHOD = '累计' OR bonussend.METHOD = '累計' )
			WHERE
				IFNULL( base.STATUS, '0' ) = '0'
			GROUP BY
			USER_ID
			) tablewages
	</select>
</mapper>
