<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.nt.service_pfans.PFANS6000.mapper.CompanyStatisticsMapper">

	<select id="getWorkTimes" parameterType="map" resultType="com.nt.dao_Pfans.PFANS6000.CompanyStatistics">

		select a.SUPPLIERINFOR_ID as bpcompany,
		IFNULL(a.JANUARY,0) as manhour1, IFNULL(a.FEBRUARY,0) as manhour2, IFNULL(a.MARCH,0) as manhour3, IFNULL(a.APRIL,0) as manhour4, IFNULL(a.MAY,0) as manhour5, IFNULL(a.JUNE,0) as manhour6,
		IFNULL(a.JULY,0) as manhour7, IFNULL(a.AUGUST,0) as manhour8, IFNULL(a.SEPTEMBER,0) as manhour9, IFNULL(a.OCTOBER,0) as manhour10, IFNULL(a.NOVEMBER,0) as manhour11, IFNULL(a.DECEMBER,0) as manhour12,
		IFNULL(b.JANUARY,0) as cost1, IFNULL(b.FEBRUARY,0) as cost2, IFNULL(b.MARCH,0) as cost3, IFNULL(b.APRIL,0) as cost4, IFNULL(b.MAY,0) as cost5, IFNULL(b.JUNE,0) as cost6,
		IFNULL(b.JULY,0) as cost7, IFNULL(b.AUGUST,0) as cost8, IFNULL(b.SEPTEMBER,0) as cost9, IFNULL(b.OCTOBER,0) as cost10, IFNULL(b.NOVEMBER,0) as cost11, IFNULL(b.DECEMBER,0) as cost12
		from
		(
		select exp.SUPPLIERINFOR_ID,sum(df.`JANUARY`) as JANUARY, sum(df.FEBRUARY) as FEBRUARY,
		sum(df.MARCH) as MARCH, sum(df.APRIL) as APRIL, sum(df.MAY) as MAY, sum(df.JUNE) as JUNE,
		sum(df.`JULY`) as JULY, sum(df.AUGUST) as AUGUST, sum(df.SEPTEMBER) as SEPTEMBER, sum(df.OCTOBER) as OCTOBER,
		sum(df.NOVEMBER) as NOVEMBER, sum(df.DECEMBER) as DECEMBER
		from delegainformation df
		inner join companyprojects cp
		on df.COMPANYPROJECTS_ID = cp.COMPANYPROJECTS_ID
		inner join projectsystem ps
		on cp.COMPANYPROJECTS_ID = ps.COMPANYPROJECTS_ID
		and df.`PROJECTSYSTEM_ID` = ps.`PROJECTSYSTEM_ID`
		inner join expatriatesinfor exp
		on ps.SUPPLIERNAMEID = exp.EXPATRIATESINFOR_ID
		where df.status = '0'
		<if test="owner!=null">
			and OWNER = #{owner}
		</if>
		and exp.VENUETARGET = #{yesValue}
		group by exp.SUPPLIERINFOR_ID
		) a
		left join (
		select exp.SUPPLIERINFOR_ID,sum(df.`JANUARY`) as JANUARY, sum(df.FEBRUARY) as FEBRUARY,
		sum(df.MARCH) as MARCH, sum(df.APRIL) as APRIL, sum(df.MAY) as MAY, sum(df.JUNE) as JUNE,
		sum(df.`JULY`) as JULY, sum(df.AUGUST) as AUGUST, sum(df.SEPTEMBER) as SEPTEMBER, sum(df.OCTOBER) as OCTOBER,
		sum(df.NOVEMBER) as NOVEMBER, sum(df.DECEMBER) as DECEMBER
		from delegainformation df
		inner join companyprojects cp
		on df.COMPANYPROJECTS_ID = cp.COMPANYPROJECTS_ID
		inner join projectsystem ps
		on cp.COMPANYPROJECTS_ID = ps.COMPANYPROJECTS_ID
		and df.`PROJECTSYSTEM_ID` = ps.`PROJECTSYSTEM_ID`
		inner join expatriatesinfor exp
		on ps.SUPPLIERNAMEID = exp.EXPATRIATESINFOR_ID
		where df.status = '0'
		<if test="owner!=null">
			and OWNER = #{owner}
		</if>
		and exp.VENUETARGET = #{noValue}
		group by exp.SUPPLIERINFOR_ID
		) b
		on a.SUPPLIERINFOR_ID = b.SUPPLIERINFOR_ID
	</select>

	<select id="getWorkers" parameterType="map" resultType="com.nt.dao_Pfans.PFANS6000.CompanyStatistics">
		<!--select a.SUPPLIERNAME as bpcompany, IFNULL(a.JANUARY,0) as manhour1, IFNULL(b.FEBRUARY,0) as manhour2, IFNULL(c.MARCH,0) as manhour3, IFNULL(d.APRIL,0) as manhour4, IFNULL(e.MAY,0) as manhour5,
		IFNULL(f.JUNE,0) as manhour6, IFNULL(g.JULY,0) as manhour7,IFNULL(h.AUGUST,0) as manhour8, IFNULL(i.SEPTEMBER,0) as manhour9, IFNULL(j.OCTOBER,0) as manhour10, IFNULL(k.NOVEMBER,0) as manhour11,
		IFNULL(l.DECEMBER,0) as manhour12
		from (
			select exp.SUPPLIERNAME, count(exp.`JANUARY`) as JANUARY
			from `expatriatesinfor` exp
			where
			1 = 1
			<if test="owner!=null">
				and OWNER = #{owner}
			</if>
			and VENUETARGET = #{yesValue}
			and exp.`JANUARY` != '0'
			group by SUPPLIERNAME
		) a
		left join(
			select exp.SUPPLIERNAME, count(exp.`FEBRUARY`) as FEBRUARY
			from `expatriatesinfor` exp
			where
			1 = 1
			<if test="owner!=null">
				and OWNER = #{owner}
			</if>
			and VENUETARGET = #{yesValue}
			and exp.`FEBRUARY` != '0'
			group by SUPPLIERNAME
		) b
		on a.SUPPLIERNAME = b.SUPPLIERNAME
		left join(
			select exp.SUPPLIERNAME, count(exp.`MARCH`) as MARCH
			from `expatriatesinfor` exp
			where
			1 = 1
			<if test="owner!=null">
				and OWNER = #{owner}
			</if>
			and VENUETARGET = #{yesValue}
			and exp.`MARCH` != '0'
			group by SUPPLIERNAME
		) c
		on a.SUPPLIERNAME = c.SUPPLIERNAME
		left join(
			select exp.SUPPLIERNAME, count(exp.`APRIL`) as APRIL
			from `expatriatesinfor` exp
			where
			1 = 1
			<if test="owner!=null">
				and OWNER = #{owner}
			</if>
			and VENUETARGET = #{yesValue}
			and exp.`APRIL` != '0'
			group by SUPPLIERNAME
		) d
		on a.SUPPLIERNAME = d.SUPPLIERNAME
		left join(
			select exp.SUPPLIERNAME, count(exp.`MAY`) as MAY
			from `expatriatesinfor` exp
			where
			1 = 1
			<if test="owner!=null">
				and OWNER = #{owner}
			</if>
			and VENUETARGET = #{yesValue}
			and exp.`MAY` != '0'
			group by SUPPLIERNAME
		) e
		on a.SUPPLIERNAME = e.SUPPLIERNAME
		left join(
			select exp.SUPPLIERNAME, count(exp.`JUNE`) as JUNE
			from `expatriatesinfor` exp
			where
			1 = 1
			<if test="owner!=null">
				and OWNER = #{owner}
			</if>
			and VENUETARGET = #{yesValue}
			and exp.`JUNE` != '0'
			group by SUPPLIERNAME
		) f
		on a.SUPPLIERNAME = f.SUPPLIERNAME
		left join(
			select exp.SUPPLIERNAME, count(exp.`JULY`) as JULY
			from `expatriatesinfor` exp
			where
			1 = 1
			<if test="owner!=null">
				and OWNER = #{owner}
			</if>
			and VENUETARGET = #{yesValue}
			and exp.`JULY` != '0'
			group by SUPPLIERNAME
		) g
		on a.SUPPLIERNAME = g.SUPPLIERNAME
		left join(
			select exp.SUPPLIERNAME, count(exp.`AUGUST`) as AUGUST
			from `expatriatesinfor` exp
			where
			1 = 1
			<if test="owner!=null">
				and OWNER = #{owner}
			</if>
			and VENUETARGET = #{yesValue}
			and exp.`AUGUST` != '0'
			group by SUPPLIERNAME
		) h
		on a.SUPPLIERNAME = h.SUPPLIERNAME
		left join(
			select exp.SUPPLIERNAME, count(exp.`SEPTEMBER`) as SEPTEMBER
			from `expatriatesinfor` exp
			where
			1 = 1
			<if test="owner!=null">
				and OWNER = #{owner}
			</if>
			and VENUETARGET = #{yesValue}
			and exp.`SEPTEMBER` != '0'
			group by SUPPLIERNAME
		) i
		on a.SUPPLIERNAME = i.SUPPLIERNAME
		left join(
			select exp.SUPPLIERNAME, count(exp.`OCTOBER`) as OCTOBER
			from `expatriatesinfor` exp
			where
			1 = 1
			<if test="owner!=null">
				and OWNER = #{owner}
			</if>
			and VENUETARGET = #{yesValue}
			and exp.`OCTOBER` != '0'
			group by SUPPLIERNAME
		) j
		on a.SUPPLIERNAME = j.SUPPLIERNAME
		left join(
			select exp.SUPPLIERNAME, count(exp.`NOVEMBER`) as NOVEMBER
			from `expatriatesinfor` exp
			where
			1 = 1
			<if test="owner!=null">
				and OWNER = #{owner}
			</if>
			and VENUETARGET = #{yesValue}
			and exp.`NOVEMBER` != '0'
			group by SUPPLIERNAME
		) k
		on a.SUPPLIERNAME = k.SUPPLIERNAME
		left join(
			select exp.SUPPLIERNAME, count(exp.`DECEMBER`) as DECEMBER
			from `expatriatesinfor` exp
			where
			1 = 1
			<if test="owner!=null">
				and OWNER = #{owner}
			</if>
			and VENUETARGET = #{yesValue}
			and exp.`DECEMBER` != '0'
			group by SUPPLIERNAME
		) l
		on a.SUPPLIERNAME = l.SUPPLIERNAME-->
		select a.SUPPLIERINFOR_ID as bpcompany, IFNULL(a.JANUARY,0) as manhour1, IFNULL(b.FEBRUARY,0) as manhour2, IFNULL(c.MARCH,0) as manhour3, IFNULL(d.APRIL,0) as manhour4, IFNULL(e.MAY,0) as manhour5,
		IFNULL(f.JUNE,0) as manhour6, IFNULL(g.JULY,0) as manhour7,IFNULL(h.AUGUST,0) as manhour8, IFNULL(i.SEPTEMBER,0) as manhour9, IFNULL(j.OCTOBER,0) as manhour10, IFNULL(k.NOVEMBER,0) as manhour11,
		IFNULL(l.DECEMBER,0) as manhour12
		from (
			select exp.SUPPLIERINFOR_ID,count(df.`JANUARY`) as JANUARY
			from delegainformation df
			inner join companyprojects cp
			on df.COMPANYPROJECTS_ID = cp.COMPANYPROJECTS_ID
			inner join projectsystem ps
			on cp.COMPANYPROJECTS_ID = ps.COMPANYPROJECTS_ID
			and df.`PROJECTSYSTEM_ID` = ps.`PROJECTSYSTEM_ID`
			inner join expatriatesinfor exp
			on ps.SUPPLIERNAMEID = exp.EXPATRIATESINFOR_ID
			where df.status = '0'
			and df.`JANUARY` != '0'
			<if test="owner!=null">
				and OWNER = #{owner}
			</if>
			and exp.VENUETARGET = #{yesValue}
			group by exp.SUPPLIERINFOR_ID
		) a
		left join(
			select exp.SUPPLIERINFOR_ID, count(df.`FEBRUARY`) as FEBRUARY
			from delegainformation df
			inner join companyprojects cp
			on df.COMPANYPROJECTS_ID = cp.COMPANYPROJECTS_ID
			inner join projectsystem ps
			on cp.COMPANYPROJECTS_ID = ps.COMPANYPROJECTS_ID
			and df.`PROJECTSYSTEM_ID` = ps.`PROJECTSYSTEM_ID`
			inner join expatriatesinfor exp
			on ps.SUPPLIERNAMEID = exp.EXPATRIATESINFOR_ID
			where df.status = '0'
			and df.`FEBRUARY` != '0'
			<if test="owner!=null">
				and OWNER = #{owner}
			</if>
			and exp.VENUETARGET = #{yesValue}
			group by exp.SUPPLIERINFOR_ID
		) b
		on a.SUPPLIERINFOR_ID = b.SUPPLIERINFOR_ID
		left join(
			select exp.SUPPLIERINFOR_ID, count(df.`MARCH`) as MARCH
			from delegainformation df
			inner join companyprojects cp
			on df.COMPANYPROJECTS_ID = cp.COMPANYPROJECTS_ID
			inner join projectsystem ps
			on cp.COMPANYPROJECTS_ID = ps.COMPANYPROJECTS_ID
			and df.`PROJECTSYSTEM_ID` = ps.`PROJECTSYSTEM_ID`
			inner join expatriatesinfor exp
			on ps.SUPPLIERNAMEID = exp.EXPATRIATESINFOR_ID
			where df.status = '0'
			and df.`MARCH` != '0'
			<if test="owner!=null">
				and OWNER = #{owner}
			</if>
			and exp.VENUETARGET = #{yesValue}
			group by exp.SUPPLIERINFOR_ID
		) c
		on a.SUPPLIERINFOR_ID = c.SUPPLIERINFOR_ID
		left join(
			select exp.SUPPLIERINFOR_ID, count(df.`APRIL`) as APRIL
			from delegainformation df
			inner join companyprojects cp
			on df.COMPANYPROJECTS_ID = cp.COMPANYPROJECTS_ID
			inner join projectsystem ps
			on cp.COMPANYPROJECTS_ID = ps.COMPANYPROJECTS_ID
			and df.`PROJECTSYSTEM_ID` = ps.`PROJECTSYSTEM_ID`
			inner join expatriatesinfor exp
			on ps.SUPPLIERNAMEID = exp.EXPATRIATESINFOR_ID
			where df.status = '0'
			and df.`APRIL` != '0'
			<if test="owner!=null">
				and OWNER = #{owner}
			</if>
			and exp.VENUETARGET = #{yesValue}
			group by exp.SUPPLIERINFOR_ID
		) d
		on a.SUPPLIERINFOR_ID = d.SUPPLIERINFOR_ID
		left join(
			select exp.SUPPLIERINFOR_ID, count(df.`MAY`) as MAY
			from delegainformation df
			inner join companyprojects cp
			on df.COMPANYPROJECTS_ID = cp.COMPANYPROJECTS_ID
			inner join projectsystem ps
			on cp.COMPANYPROJECTS_ID = ps.COMPANYPROJECTS_ID
			and df.`PROJECTSYSTEM_ID` = ps.`PROJECTSYSTEM_ID`
			inner join expatriatesinfor exp
			on ps.SUPPLIERNAMEID = exp.EXPATRIATESINFOR_ID
			where df.status = '0'
			and df.`MAY` != '0'
			<if test="owner!=null">
				and OWNER = #{owner}
			</if>
			and exp.VENUETARGET = #{yesValue}
			group by exp.SUPPLIERINFOR_ID
		) e
		on a.SUPPLIERINFOR_ID = e.SUPPLIERINFOR_ID
		left join(
			select exp.SUPPLIERINFOR_ID, count(df.`JUNE`) as JUNE
			from delegainformation df
			inner join companyprojects cp
			on df.COMPANYPROJECTS_ID = cp.COMPANYPROJECTS_ID
			inner join projectsystem ps
			on cp.COMPANYPROJECTS_ID = ps.COMPANYPROJECTS_ID
			and df.`PROJECTSYSTEM_ID` = ps.`PROJECTSYSTEM_ID`
			inner join expatriatesinfor exp
			on ps.SUPPLIERNAMEID = exp.EXPATRIATESINFOR_ID
			where df.status = '0'
			and df.`JUNE` != '0'
			<if test="owner!=null">
				and OWNER = #{owner}
			</if>
			and exp.VENUETARGET = #{yesValue}
			group by exp.SUPPLIERINFOR_ID
		) f
		on a.SUPPLIERINFOR_ID = f.SUPPLIERINFOR_ID
		left join(
			select exp.SUPPLIERINFOR_ID, count(df.`JULY`) as JULY
			from delegainformation df
			inner join companyprojects cp
			on df.COMPANYPROJECTS_ID = cp.COMPANYPROJECTS_ID
			inner join projectsystem ps
			on cp.COMPANYPROJECTS_ID = ps.COMPANYPROJECTS_ID
			and df.`PROJECTSYSTEM_ID` = ps.`PROJECTSYSTEM_ID`
			inner join expatriatesinfor exp
			on ps.SUPPLIERNAMEID = exp.EXPATRIATESINFOR_ID
			where df.status = '0'
			and df.`JULY` != '0'
			<if test="owner!=null">
				and OWNER = #{owner}
			</if>
			and exp.VENUETARGET = #{yesValue}
			group by exp.SUPPLIERINFOR_ID
		) g
		on a.SUPPLIERINFOR_ID = g.SUPPLIERINFOR_ID
		left join(
			select exp.SUPPLIERINFOR_ID, count(df.`AUGUST`) as AUGUST
			from delegainformation df
			inner join companyprojects cp
			on df.COMPANYPROJECTS_ID = cp.COMPANYPROJECTS_ID
			inner join projectsystem ps
			on cp.COMPANYPROJECTS_ID = ps.COMPANYPROJECTS_ID
			and df.`PROJECTSYSTEM_ID` = ps.`PROJECTSYSTEM_ID`
			inner join expatriatesinfor exp
			on ps.SUPPLIERNAMEID = exp.EXPATRIATESINFOR_ID
			where df.status = '0'
			and df.`AUGUST` != '0'
			<if test="owner!=null">
				and OWNER = #{owner}
			</if>
			and exp.VENUETARGET = #{yesValue}
			group by exp.SUPPLIERINFOR_ID
		) h
		on a.SUPPLIERINFOR_ID = h.SUPPLIERINFOR_ID
		left join(
			select exp.SUPPLIERINFOR_ID, count(df.`SEPTEMBER`) as SEPTEMBER
			from delegainformation df
			inner join companyprojects cp
			on df.COMPANYPROJECTS_ID = cp.COMPANYPROJECTS_ID
			inner join projectsystem ps
			on cp.COMPANYPROJECTS_ID = ps.COMPANYPROJECTS_ID
			and df.`PROJECTSYSTEM_ID` = ps.`PROJECTSYSTEM_ID`
			inner join expatriatesinfor exp
			on ps.SUPPLIERNAMEID = exp.EXPATRIATESINFOR_ID
			where df.status = '0'
			and df.`SEPTEMBER` != '0'
			<if test="owner!=null">
				and OWNER = #{owner}
			</if>
			and exp.VENUETARGET = #{yesValue}
			group by exp.SUPPLIERINFOR_ID
		) i
		on a.SUPPLIERINFOR_ID = i.SUPPLIERINFOR_ID
		left join(
			select exp.SUPPLIERINFOR_ID, count(df.`OCTOBER`) as OCTOBER
			from delegainformation df
			inner join companyprojects cp
			on df.COMPANYPROJECTS_ID = cp.COMPANYPROJECTS_ID
			inner join projectsystem ps
			on cp.COMPANYPROJECTS_ID = ps.COMPANYPROJECTS_ID
			and df.`PROJECTSYSTEM_ID` = ps.`PROJECTSYSTEM_ID`
			inner join expatriatesinfor exp
			on ps.SUPPLIERNAMEID = exp.EXPATRIATESINFOR_ID
			where df.status = '0'
			and df.`OCTOBER` != '0'
			<if test="owner!=null">
				and OWNER = #{owner}
			</if>
			and exp.VENUETARGET = #{yesValue}
			group by exp.SUPPLIERINFOR_ID
		) j
		on a.SUPPLIERINFOR_ID = j.SUPPLIERINFOR_ID
		left join(
			select exp.SUPPLIERINFOR_ID, count(df.`NOVEMBER`) as NOVEMBER
			from delegainformation df
			inner join companyprojects cp
			on df.COMPANYPROJECTS_ID = cp.COMPANYPROJECTS_ID
			inner join projectsystem ps
			on cp.COMPANYPROJECTS_ID = ps.COMPANYPROJECTS_ID
			and df.`PROJECTSYSTEM_ID` = ps.`PROJECTSYSTEM_ID`
			inner join expatriatesinfor exp
			on ps.SUPPLIERNAMEID = exp.EXPATRIATESINFOR_ID
			where df.status = '0'
			and df.`NOVEMBER` != '0'
			<if test="owner!=null">
				and OWNER = #{owner}
			</if>
			and exp.VENUETARGET = #{yesValue}
			group by exp.SUPPLIERINFOR_ID
		) k
		on a.SUPPLIERINFOR_ID = k.SUPPLIERINFOR_ID
		left join(
			select exp.SUPPLIERINFOR_ID, count(df.`DECEMBER`) as DECEMBER
			from delegainformation df
			inner join companyprojects cp
			on df.COMPANYPROJECTS_ID = cp.COMPANYPROJECTS_ID
			inner join projectsystem ps
			on cp.COMPANYPROJECTS_ID = ps.COMPANYPROJECTS_ID
			and df.`PROJECTSYSTEM_ID` = ps.`PROJECTSYSTEM_ID`
			inner join expatriatesinfor exp
			on ps.SUPPLIERNAMEID = exp.EXPATRIATESINFOR_ID
			where df.status = '0'
			and df.`DECEMBER` != '0'
			<if test="owner!=null">
				and OWNER = #{owner}
			</if>
			and exp.VENUETARGET = #{yesValue}
			group by exp.SUPPLIERINFOR_ID
		) l
		on a.SUPPLIERINFOR_ID = l.SUPPLIERINFOR_ID
	</select>

	<select id="getbpsum" resultType="com.nt.dao_Pfans.PFANS6000.Vo.bpSum3Vo">
	    select
		<if test="groupid!=null and groupid !=''">
		*
			from
			(
				SELECT
				`t`.`GROUP_ID` AS `GROUP_ID`,
				`t`.`SUPPLIERNAME` AS `SUPPLIERNAME`,
				`t`.`year` AS `year`,(
				CASE

				WHEN (
				date_format( now(), '%Y-%m' ) &lt; concat( `t`.`year`, '-04' )) THEN
				0 ELSE `t`.`APRIL`
				END
				) AS `APRIL`,(
				CASE

				WHEN (
				date_format( now(), '%Y-%m' ) &lt; concat( `t`.`year`, '-05' )) THEN
				0 ELSE `t`.`MAY`
				END
				) AS `MAY`,(
				CASE

				WHEN (
				date_format( now(), '%Y-%m' ) &lt; concat( `t`.`year`, '-06' )) THEN
				0 ELSE `t`.`JUNE`
				END
				) AS `JUNE`,(
				CASE

				WHEN (
				date_format( now(), '%Y-%m' ) &lt; concat( `t`.`year`, '-07' )) THEN
				0 ELSE `t`.`JULY`
				END
				) AS `JULY`,(
				CASE

				WHEN (
				date_format( now(), '%Y-%m' ) &lt; concat( `t`.`year`, '-08' )) THEN
				0 ELSE `t`.`AUGUST`
				END
				) AS `AUGUST`,(
				CASE

				WHEN (
				date_format( now(), '%Y-%m' ) &lt; concat( `t`.`year`, '-09' )) THEN
				0 ELSE `t`.`SEPTEMBER`
				END
				) AS `SEPTEMBER`,(
				CASE

				WHEN (
				date_format( now(), '%Y-%m' ) &lt; concat( `t`.`year`, '-10' )) THEN
				0 ELSE `t`.`OCTOBER`
				END
				) AS `OCTOBER`,(
				CASE

				WHEN (
				date_format( now(), '%Y-%m' ) &lt; concat( `t`.`year`, '-11' )) THEN
				0 ELSE `t`.`NOVEMBER`
				END
				) AS `NOVEMBER`,(
				CASE

				WHEN (
				date_format( now(), '%Y-%m' ) &lt; concat( `t`.`year`, '-12' )) THEN
				0 ELSE `t`.`DECEMBER`
				END
				) AS `DECEMBER`,(
				CASE

				WHEN (
				date_format( now(), '%Y-%m' ) &lt; CONVERT ( concat(( cast( `t`.`year` AS DECIMAL ( 10, 0 )) + 1 ), '-01' ) USING utf8mb4 )) THEN
				0 ELSE `t`.`JANUARY`
				END
				) AS `JANUARY`,(
				CASE

				WHEN (
				date_format( now(), '%Y-%m' ) &lt; CONVERT ( concat(( cast( `t`.`year` AS DECIMAL ( 10, 0 )) + 1 ), '-02' ) USING utf8mb4 )) THEN
				0 ELSE `t`.`FEBRUARY`
				END
				) AS `FEBRUARY`,(
				CASE

				WHEN (
				date_format( now(), '%Y-%m' ) &lt; CONVERT ( concat(( cast( `t`.`year` AS DECIMAL ( 10, 0 )) + 1 ), '-03' ) USING utf8mb4 )) THEN
				0 ELSE `t`.`MARCH`
				END
				) AS `MARCH`
				FROM
				(
				SELECT
				`tmp`.`GROUP_ID` AS `GROUP_ID`,
				`tmp`.`SUPPLIERNAME` AS `SUPPLIERNAME`,
				`tmp`.`yaer` AS `year`,
				sum((
				CASE

				WHEN ( `tmp`.`EXITIME` IS NULL ) THEN
				(
				CASE

				WHEN (
				date_format( `tmp`.`TIMESTR`, '%Y-%m' ) > concat( `tmp`.`yaer`, '-04' )) THEN
				0 ELSE (
				CASE

				WHEN ( `tmp`.`TIMEEND` IS NOT NULL ) THEN
				( CASE WHEN ( date_format( `tmp`.`TIMEEND`, '%Y-%m' ) >= concat( `tmp`.`yaer`, '-04' )) THEN 1 ELSE 0 END ) ELSE 1
				END
				)
				END
				) ELSE (
				CASE

				WHEN (
				date_format( `tmp`.`EXITIME`, '%Y-%m' ) &lt; concat( `tmp`.`yaer`, '-04' )) THEN 0 ELSE ( CASE WHEN ( date_format( `tmp`.`TIMESTR`, '%Y-%m' ) > concat( `tmp`.`yaer`, '-04' )) THEN
				0 ELSE (
				CASE

				WHEN ( `tmp`.`TIMEEND` IS NOT NULL ) THEN
				( CASE WHEN ( date_format( `tmp`.`TIMEEND`, '%Y-%m' ) >= concat( `tmp`.`yaer`, '-04' )) THEN 1 ELSE 0 END ) ELSE 1
				END
				)
				END
				)
				END
				)
				END
				)) AS `APRIL`,
				sum((
				CASE

				WHEN ( `tmp`.`EXITIME` IS NULL ) THEN
				(
				CASE

				WHEN (
				date_format( `tmp`.`TIMESTR`, '%Y-%m' ) > concat( `tmp`.`yaer`, '-05' )) THEN
				0 ELSE (
				CASE

				WHEN ( `tmp`.`TIMEEND` IS NOT NULL ) THEN
				( CASE WHEN ( date_format( `tmp`.`TIMEEND`, '%Y-%m' ) >= concat( `tmp`.`yaer`, '-05' )) THEN 1 ELSE 0 END ) ELSE 1
				END
				)
				END
				) ELSE (
				CASE

				WHEN (
				date_format( `tmp`.`EXITIME`, '%Y-%m' ) &lt; concat( `tmp`.`yaer`, '-05' )) THEN 0 ELSE ( CASE WHEN ( date_format( `tmp`.`TIMESTR`, '%Y-%m' ) > concat( `tmp`.`yaer`, '-05' )) THEN
				0 ELSE (
				CASE

				WHEN ( `tmp`.`TIMEEND` IS NOT NULL ) THEN
				( CASE WHEN ( date_format( `tmp`.`TIMEEND`, '%Y-%m' ) >= concat( `tmp`.`yaer`, '-05' )) THEN 1 ELSE 0 END ) ELSE 1
				END
				)
				END
				)
				END
				)
				END
				)) AS `MAY`,
				sum((
				CASE

				WHEN ( `tmp`.`EXITIME` IS NULL ) THEN
				(
				CASE

				WHEN (
				date_format( `tmp`.`TIMESTR`, '%Y-%m' ) > concat( `tmp`.`yaer`, '-06' )) THEN
				0 ELSE (
				CASE

				WHEN ( `tmp`.`TIMEEND` IS NOT NULL ) THEN
				( CASE WHEN ( date_format( `tmp`.`TIMEEND`, '%Y-%m' ) >= concat( `tmp`.`yaer`, '-06' )) THEN 1 ELSE 0 END ) ELSE 1
				END
				)
				END
				) ELSE (
				CASE

				WHEN (
				date_format( `tmp`.`EXITIME`, '%Y-%m' ) &lt; concat( `tmp`.`yaer`, '-06' )) THEN 0 ELSE ( CASE WHEN ( date_format( `tmp`.`TIMESTR`, '%Y-%m' ) > concat( `tmp`.`yaer`, '-06' )) THEN
				0 ELSE (
				CASE

				WHEN ( `tmp`.`TIMEEND` IS NOT NULL ) THEN
				( CASE WHEN ( date_format( `tmp`.`TIMEEND`, '%Y-%m' ) >= concat( `tmp`.`yaer`, '-06' )) THEN 1 ELSE 0 END ) ELSE 1
				END
				)
				END
				)
				END
				)
				END
				)) AS `JUNE`,
				sum((
				CASE

				WHEN ( `tmp`.`EXITIME` IS NULL ) THEN
				(
				CASE

				WHEN (
				date_format( `tmp`.`TIMESTR`, '%Y-%m' ) > concat( `tmp`.`yaer`, '-07' )) THEN
				0 ELSE (
				CASE

				WHEN ( `tmp`.`TIMEEND` IS NOT NULL ) THEN
				( CASE WHEN ( date_format( `tmp`.`TIMEEND`, '%Y-%m' ) >= concat( `tmp`.`yaer`, '-07' )) THEN 1 ELSE 0 END ) ELSE 1
				END
				)
				END
				) ELSE (
				CASE

				WHEN (
				date_format( `tmp`.`EXITIME`, '%Y-%m' ) &lt; concat( `tmp`.`yaer`, '-07' )) THEN 0 ELSE ( CASE WHEN ( date_format( `tmp`.`TIMESTR`, '%Y-%m' ) > concat( `tmp`.`yaer`, '-07' )) THEN
				0 ELSE (
				CASE

				WHEN ( `tmp`.`TIMEEND` IS NOT NULL ) THEN
				( CASE WHEN ( date_format( `tmp`.`TIMEEND`, '%Y-%m' ) >= concat( `tmp`.`yaer`, '-07' )) THEN 1 ELSE 0 END ) ELSE 1
				END
				)
				END
				)
				END
				)
				END
				)) AS `JULY`,
				sum((
				CASE

				WHEN ( `tmp`.`EXITIME` IS NULL ) THEN
				(
				CASE

				WHEN (
				date_format( `tmp`.`TIMESTR`, '%Y-%m' ) > concat( `tmp`.`yaer`, '-08' )) THEN
				0 ELSE (
				CASE

				WHEN ( `tmp`.`TIMEEND` IS NOT NULL ) THEN
				( CASE WHEN ( date_format( `tmp`.`TIMEEND`, '%Y-%m' ) >= concat( `tmp`.`yaer`, '-08' )) THEN 1 ELSE 0 END ) ELSE 1
				END
				)
				END
				) ELSE (
				CASE

				WHEN (
				date_format( `tmp`.`EXITIME`, '%Y-%m' ) &lt; concat( `tmp`.`yaer`, '-08' )) THEN 0 ELSE ( CASE WHEN ( date_format( `tmp`.`TIMESTR`, '%Y-%m' ) > concat( `tmp`.`yaer`, '-08' )) THEN
				0 ELSE (
				CASE

				WHEN ( `tmp`.`TIMEEND` IS NOT NULL ) THEN
				( CASE WHEN ( date_format( `tmp`.`TIMEEND`, '%Y-%m' ) >= concat( `tmp`.`yaer`, '-08' )) THEN 1 ELSE 0 END ) ELSE 1
				END
				)
				END
				)
				END
				)
				END
				)) AS `AUGUST`,
				sum((
				CASE

				WHEN ( `tmp`.`EXITIME` IS NULL ) THEN
				(
				CASE

				WHEN (
				date_format( `tmp`.`TIMESTR`, '%Y-%m' ) > concat( `tmp`.`yaer`, '-09' )) THEN
				0 ELSE (
				CASE

				WHEN ( `tmp`.`TIMEEND` IS NOT NULL ) THEN
				( CASE WHEN ( date_format( `tmp`.`TIMEEND`, '%Y-%m' ) >= concat( `tmp`.`yaer`, '-09' )) THEN 1 ELSE 0 END ) ELSE 1
				END
				)
				END
				) ELSE (
				CASE

				WHEN (
				date_format( `tmp`.`EXITIME`, '%Y-%m' ) &lt; concat( `tmp`.`yaer`, '-09' )) THEN 0 ELSE ( CASE WHEN ( date_format( `tmp`.`TIMESTR`, '%Y-%m' ) > concat( `tmp`.`yaer`, '-09' )) THEN
				0 ELSE (
				CASE

				WHEN ( `tmp`.`TIMEEND` IS NOT NULL ) THEN
				( CASE WHEN ( date_format( `tmp`.`TIMEEND`, '%Y-%m' ) >= concat( `tmp`.`yaer`, '-09' )) THEN 1 ELSE 0 END ) ELSE 1
				END
				)
				END
				)
				END
				)
				END
				)) AS `SEPTEMBER`,
				sum((
				CASE

				WHEN ( `tmp`.`EXITIME` IS NULL ) THEN
				(
				CASE

				WHEN (
				date_format( `tmp`.`TIMESTR`, '%Y-%m' ) > concat( `tmp`.`yaer`, '-10' )) THEN
				0 ELSE (
				CASE

				WHEN ( `tmp`.`TIMEEND` IS NOT NULL ) THEN
				( CASE WHEN ( date_format( `tmp`.`TIMEEND`, '%Y-%m' ) >= concat( `tmp`.`yaer`, '-10' )) THEN 1 ELSE 0 END ) ELSE 1
				END
				)
				END
				) ELSE (
				CASE

				WHEN (
				date_format( `tmp`.`EXITIME`, '%Y-%m' ) &lt; concat( `tmp`.`yaer`, '-10' )) THEN 0 ELSE ( CASE WHEN ( date_format( `tmp`.`TIMESTR`, '%Y-%m' ) > concat( `tmp`.`yaer`, '-10' )) THEN
				0 ELSE (
				CASE

				WHEN ( `tmp`.`TIMEEND` IS NOT NULL ) THEN
				( CASE WHEN ( date_format( `tmp`.`TIMEEND`, '%Y-%m' ) >= concat( `tmp`.`yaer`, '-10' )) THEN 1 ELSE 0 END ) ELSE 1
				END
				)
				END
				)
				END
				)
				END
				)) AS `OCTOBER`,
				sum((
				CASE

				WHEN ( `tmp`.`EXITIME` IS NULL ) THEN
				(
				CASE

				WHEN (
				date_format( `tmp`.`TIMESTR`, '%Y-%m' ) > concat( `tmp`.`yaer`, '-11' )) THEN
				0 ELSE (
				CASE

				WHEN ( `tmp`.`TIMEEND` IS NOT NULL ) THEN
				( CASE WHEN ( date_format( `tmp`.`TIMEEND`, '%Y-%m' ) >= concat( `tmp`.`yaer`, '-11' )) THEN 1 ELSE 0 END ) ELSE 1
				END
				)
				END
				) ELSE (
				CASE

				WHEN (
				date_format( `tmp`.`EXITIME`, '%Y-%m' ) &lt; concat( `tmp`.`yaer`, '-11' )) THEN 0 ELSE ( CASE WHEN ( date_format( `tmp`.`TIMESTR`, '%Y-%m' ) > concat( `tmp`.`yaer`, '-11' )) THEN
				0 ELSE (
				CASE

				WHEN ( `tmp`.`TIMEEND` IS NOT NULL ) THEN
				( CASE WHEN ( date_format( `tmp`.`TIMEEND`, '%Y-%m' ) >= concat( `tmp`.`yaer`, '-11' )) THEN 1 ELSE 0 END ) ELSE 1
				END
				)
				END
				)
				END
				)
				END
				)) AS `NOVEMBER`,
				sum((
				CASE

				WHEN ( `tmp`.`EXITIME` IS NULL ) THEN
				(
				CASE

				WHEN (
				date_format( `tmp`.`TIMESTR`, '%Y-%m' ) > concat( `tmp`.`yaer`, '-12' )) THEN
				0 ELSE (
				CASE

				WHEN ( `tmp`.`TIMEEND` IS NOT NULL ) THEN
				( CASE WHEN ( date_format( `tmp`.`TIMEEND`, '%Y-%m' ) >= concat( `tmp`.`yaer`, '-12' )) THEN 1 ELSE 0 END ) ELSE 1
				END
				)
				END
				) ELSE (
				CASE

				WHEN (
				date_format( `tmp`.`EXITIME`, '%Y-%m' ) &lt; concat( `tmp`.`yaer`, '-12' )) THEN 0 ELSE ( CASE WHEN ( date_format( `tmp`.`TIMESTR`, '%Y-%m' ) > concat( `tmp`.`yaer`, '-12' )) THEN
				0 ELSE (
				CASE

				WHEN ( `tmp`.`TIMEEND` IS NOT NULL ) THEN
				( CASE WHEN ( date_format( `tmp`.`TIMEEND`, '%Y-%m' ) >= concat( `tmp`.`yaer`, '-12' )) THEN 1 ELSE 0 END ) ELSE 1
				END
				)
				END
				)
				END
				)
				END
				)) AS `DECEMBER`,
				sum((
				CASE

				WHEN ( `tmp`.`EXITIME` IS NULL ) THEN
				(
				CASE

				WHEN (
				date_format( `tmp`.`TIMESTR`, '%Y-%m' ) > CONVERT ( concat(( cast( `tmp`.`yaer` AS DECIMAL ( 10, 0 )) + 1 ), '-01' ) USING utf8mb4 )) THEN
				0 ELSE (
				CASE

				WHEN ( `tmp`.`TIMEEND` IS NOT NULL ) THEN
				(
				CASE

				WHEN (
				date_format( `tmp`.`TIMEEND`, '%Y-%m' ) >= CONVERT ( concat(( cast( `tmp`.`yaer` AS DECIMAL ( 10, 0 )) + 1 ), '-01' ) USING utf8mb4 )) THEN
				1 ELSE 0
				END
				) ELSE 1
				END
				)
				END
				) ELSE (
				CASE

				WHEN (
				date_format( `tmp`.`EXITIME`, '%Y-%m' ) &lt; CONVERT ( concat(( cast( `tmp`.`yaer` AS DECIMAL ( 10, 0 )) + 1 ), '-01' ) USING utf8mb4 )) THEN
				0 ELSE (
				CASE

				WHEN (
				date_format( `tmp`.`TIMESTR`, '%Y-%m' ) > CONVERT ( concat(( cast( `tmp`.`yaer` AS DECIMAL ( 10, 0 )) + 1 ), '-01' ) USING utf8mb4 )) THEN
				0 ELSE (
				CASE

				WHEN ( `tmp`.`TIMEEND` IS NOT NULL ) THEN
				(
				CASE

				WHEN (
				date_format( `tmp`.`TIMEEND`, '%Y-%m' ) >= CONVERT ( concat(( cast( `tmp`.`yaer` AS DECIMAL ( 10, 0 )) + 1 ), '-01' ) USING utf8mb4 )) THEN
				1 ELSE 0
				END
				) ELSE 1
				END
				)
				END
				)
				END
				)
				END
				)) AS `JANUARY`,
				sum((
				CASE

				WHEN ( `tmp`.`EXITIME` IS NULL ) THEN
				(
				CASE

				WHEN (
				date_format( `tmp`.`TIMESTR`, '%Y-%m' ) > CONVERT ( concat(( cast( `tmp`.`yaer` AS DECIMAL ( 10, 0 )) + 1 ), '-02' ) USING utf8mb4 )) THEN
				0 ELSE (
				CASE

				WHEN ( `tmp`.`TIMEEND` IS NOT NULL ) THEN
				(
				CASE

				WHEN (
				date_format( `tmp`.`TIMEEND`, '%Y-%m' ) >= CONVERT ( concat(( cast( `tmp`.`yaer` AS DECIMAL ( 10, 0 )) + 1 ), '-02' ) USING utf8mb4 )) THEN
				1 ELSE 0
				END
				) ELSE 1
				END
				)
				END
				) ELSE (
				CASE

				WHEN (
				date_format( `tmp`.`EXITIME`, '%Y-%m' ) &lt; CONVERT ( concat(( cast( `tmp`.`yaer` AS DECIMAL ( 10, 0 )) + 1 ), '-02' ) USING utf8mb4 )) THEN
				0 ELSE (
				CASE

				WHEN (
				date_format( `tmp`.`TIMESTR`, '%Y-%m' ) > CONVERT ( concat(( cast( `tmp`.`yaer` AS DECIMAL ( 10, 0 )) + 1 ), '-02' ) USING utf8mb4 )) THEN
				0 ELSE (
				CASE

				WHEN ( `tmp`.`TIMEEND` IS NOT NULL ) THEN
				(
				CASE

				WHEN (
				date_format( `tmp`.`TIMEEND`, '%Y-%m' ) >= CONVERT ( concat(( cast( `tmp`.`yaer` AS DECIMAL ( 10, 0 )) + 1 ), '-02' ) USING utf8mb4 )) THEN
				1 ELSE 0
				END
				) ELSE 1
				END
				)
				END
				)
				END
				)
				END
				)) AS `FEBRUARY`,
				sum((
				CASE

				WHEN ( `tmp`.`EXITIME` IS NULL ) THEN
				(
				CASE

				WHEN (
				date_format( `tmp`.`TIMESTR`, '%Y-%m' ) > CONVERT ( concat(( cast( `tmp`.`yaer` AS DECIMAL ( 10, 0 )) + 1 ), '-03' ) USING utf8mb4 )) THEN
				0 ELSE (
				CASE

				WHEN ( `tmp`.`TIMEEND` IS NOT NULL ) THEN
				(
				CASE

				WHEN (
				date_format( `tmp`.`TIMEEND`, '%Y-%m' ) >= CONVERT ( concat(( cast( `tmp`.`yaer` AS DECIMAL ( 10, 0 )) + 1 ), '-03' ) USING utf8mb4 )) THEN
				1 ELSE 0
				END
				) ELSE 1
				END
				)
				END
				) ELSE (
				CASE

				WHEN (
				date_format( `tmp`.`EXITIME`, '%Y-%m' ) &lt; CONVERT ( concat(( cast( `tmp`.`yaer` AS DECIMAL ( 10, 0 )) + 1 ), '-03' ) USING utf8mb4 )) THEN
				0 ELSE (
				CASE

				WHEN (
				date_format( `tmp`.`TIMESTR`, '%Y-%m' ) > CONVERT ( concat(( cast( `tmp`.`yaer` AS DECIMAL ( 10, 0 )) + 1 ), '-03' ) USING utf8mb4 )) THEN
				0 ELSE (
				CASE

				WHEN ( `tmp`.`TIMEEND` IS NOT NULL ) THEN
				(
				CASE

				WHEN (
				date_format( `tmp`.`TIMEEND`, '%Y-%m' ) >= CONVERT ( concat(( cast( `tmp`.`yaer` AS DECIMAL ( 10, 0 )) + 1 ), '-03' ) USING utf8mb4 )) THEN
				1 ELSE 0
				END
				) ELSE 1
				END
				)
				END
				)
				END
				)
				END
				)) AS `MARCH`
				FROM
				(
				SELECT
				( CASE WHEN ( `e`.`GROUP_ID` = `e1`.`GROUP_ID` ) THEN `e`.`GROUP_ID` ELSE `e1`.`GROUP_ID` END ) AS `GROUP_ID`,
				`e1`.`EXDATESTR` AS `TIMESTR`,
				`e1`.`EXDATEEND` AS `TIMEEND`,
				`e`.`EXITIME` AS `EXITIME`,
				`e`.`SUPPLIERNAME` AS `SUPPLIERNAME`,(
				CASE

				WHEN ( date_format( now(), '%m' ) &lt; '04' ) THEN
				( cast( date_format( now(), '%Y' ) AS signed ) - 1 ) ELSE date_format( now(), '%Y' )
				END
				) AS `yaer`,
				`e`.`ACCOUNT` AS `ACCOUNT`
				FROM
				(
				`expatriatesinfor` `e`
				LEFT JOIN `expatriatesinfordetail` `e1` ON ((
				`e`.`EXPATRIATESINFOR_ID` = `e1`.`EXPATRIATESINFOR_ID`
				)))
				WHERE
				((
				`e`.`OPERATIONFORM` = 'BP024001'
				)
				AND (
				`e`.`EXITS` IN ( '1', '0' )))) `tmp`
				GROUP BY
				`tmp`.`GROUP_ID`,
				`tmp`.`SUPPLIERNAME`,
				`tmp`.`yaer`
				ORDER BY
				`tmp`.`SUPPLIERNAME` DESC
				) `t`
			)
			bpsum3
			where
			year = #{years}
			and GROUP_ID= #{groupid}
			order by
			year
		</if>
		<if test="groupid ==null || groupid ==''">
			*
			from
			(
				SELECT
				`t`.`GROUP_ID` AS `GROUP_ID`,
				`t`.`SUPPLIERNAME` AS `SUPPLIERNAME`,
				`t`.`year` AS `year`,(
				CASE

				WHEN (
				date_format( now(), '%Y-%m' ) &lt; concat( `t`.`year`, '-04' )) THEN
				0 ELSE `t`.`APRIL`
				END
				) AS `APRIL`,(
				CASE

				WHEN (
				date_format( now(), '%Y-%m' ) &lt; concat( `t`.`year`, '-05' )) THEN
				0 ELSE `t`.`MAY`
				END
				) AS `MAY`,(
				CASE

				WHEN (
				date_format( now(), '%Y-%m' ) &lt; concat( `t`.`year`, '-06' )) THEN
				0 ELSE `t`.`JUNE`
				END
				) AS `JUNE`,(
				CASE

				WHEN (
				date_format( now(), '%Y-%m' ) &lt; concat( `t`.`year`, '-07' )) THEN
				0 ELSE `t`.`JULY`
				END
				) AS `JULY`,(
				CASE

				WHEN (
				date_format( now(), '%Y-%m' ) &lt; concat( `t`.`year`, '-08' )) THEN
				0 ELSE `t`.`AUGUST`
				END
				) AS `AUGUST`,(
				CASE

				WHEN (
				date_format( now(), '%Y-%m' ) &lt; concat( `t`.`year`, '-09' )) THEN
				0 ELSE `t`.`SEPTEMBER`
				END
				) AS `SEPTEMBER`,(
				CASE

				WHEN (
				date_format( now(), '%Y-%m' ) &lt; concat( `t`.`year`, '-10' )) THEN
				0 ELSE `t`.`OCTOBER`
				END
				) AS `OCTOBER`,(
				CASE

				WHEN (
				date_format( now(), '%Y-%m' ) &lt; concat( `t`.`year`, '-11' )) THEN
				0 ELSE `t`.`NOVEMBER`
				END
				) AS `NOVEMBER`,(
				CASE

				WHEN (
				date_format( now(), '%Y-%m' ) &lt; concat( `t`.`year`, '-12' )) THEN
				0 ELSE `t`.`DECEMBER`
				END
				) AS `DECEMBER`,(
				CASE

				WHEN (
				date_format( now(), '%Y-%m' ) &lt; CONVERT ( concat(( cast( `t`.`year` AS DECIMAL ( 10, 0 )) + 1 ), '-01' ) USING utf8mb4 )) THEN
				0 ELSE `t`.`JANUARY`
				END
				) AS `JANUARY`,(
				CASE

				WHEN (
				date_format( now(), '%Y-%m' ) &lt; CONVERT ( concat(( cast( `t`.`year` AS DECIMAL ( 10, 0 )) + 1 ), '-02' ) USING utf8mb4 )) THEN
				0 ELSE `t`.`FEBRUARY`
				END
				) AS `FEBRUARY`,(
				CASE

				WHEN (
				date_format( now(), '%Y-%m' ) &lt; CONVERT ( concat(( cast( `t`.`year` AS DECIMAL ( 10, 0 )) + 1 ), '-03' ) USING utf8mb4 )) THEN
				0 ELSE `t`.`MARCH`
				END
				) AS `MARCH`
				FROM
				(
				SELECT
				`tmp`.`GROUP_ID` AS `GROUP_ID`,
				`tmp`.`SUPPLIERNAME` AS `SUPPLIERNAME`,
				`tmp`.`yaer` AS `year`,
				sum((
				CASE

				WHEN ( `tmp`.`TIME` IS NOT NULL ) THEN
				( CASE WHEN ( date_format( `tmp`.`TIME`, '%Y-%m' ) &lt; concat( `tmp`.`yaer`, '-04' )) THEN 0 ELSE 1 END ) ELSE 1
				END
				)) AS `APRIL`,
				sum((
				CASE

				WHEN ( `tmp`.`TIME` IS NOT NULL ) THEN
				( CASE WHEN ( date_format( `tmp`.`TIME`, '%Y-%m' ) &lt; concat( `tmp`.`yaer`, '-05' )) THEN 0 ELSE 1 END ) ELSE 1
				END
				)) AS `MAY`,
				sum((
				CASE

				WHEN ( `tmp`.`TIME` IS NOT NULL ) THEN
				( CASE WHEN ( date_format( `tmp`.`TIME`, '%Y-%m' ) &lt; concat( `tmp`.`yaer`, '-06' )) THEN 0 ELSE 1 END ) ELSE 1
				END
				)) AS `JUNE`,
				sum((
				CASE

				WHEN ( `tmp`.`TIME` IS NOT NULL ) THEN
				( CASE WHEN ( date_format( `tmp`.`TIME`, '%Y-%m' ) &lt; concat( `tmp`.`yaer`, '-07' )) THEN 0 ELSE 1 END ) ELSE 1
				END
				)) AS `JULY`,
				sum((
				CASE

				WHEN ( `tmp`.`TIME` IS NOT NULL ) THEN
				( CASE WHEN ( date_format( `tmp`.`TIME`, '%Y-%m' ) &lt; concat( `tmp`.`yaer`, '-08' )) THEN 0 ELSE 1 END ) ELSE 1
				END
				)) AS `AUGUST`,
				sum((
				CASE

				WHEN ( `tmp`.`TIME` IS NOT NULL ) THEN
				( CASE WHEN ( date_format( `tmp`.`TIME`, '%Y-%m' ) &lt; concat( `tmp`.`yaer`, '-09' )) THEN 0 ELSE 1 END ) ELSE 1
				END
				)) AS `SEPTEMBER`,
				sum((
				CASE

				WHEN ( `tmp`.`TIME` IS NOT NULL ) THEN
				( CASE WHEN ( date_format( `tmp`.`TIME`, '%Y-%m' ) &lt; concat( `tmp`.`yaer`, '-10' )) THEN 0 ELSE 1 END ) ELSE 1
				END
				)) AS `OCTOBER`,
				sum((
				CASE

				WHEN ( `tmp`.`TIME` IS NOT NULL ) THEN
				( CASE WHEN ( date_format( `tmp`.`TIME`, '%Y-%m' ) &lt; concat( `tmp`.`yaer`, '-11' )) THEN 0 ELSE 1 END ) ELSE 1
				END
				)) AS `NOVEMBER`,
				sum((
				CASE

				WHEN ( `tmp`.`TIME` IS NOT NULL ) THEN
				( CASE WHEN ( date_format( `tmp`.`TIME`, '%Y-%m' ) &lt; concat( `tmp`.`yaer`, '-12' )) THEN 0 ELSE 1 END ) ELSE 1
				END
				)) AS `DECEMBER`,
				sum((
				CASE

				WHEN ( `tmp`.`TIME` IS NOT NULL ) THEN
				(
				CASE

				WHEN (
				date_format( `tmp`.`TIME`, '%Y-%m' ) &lt; CONVERT ( concat(( cast( `tmp`.`yaer` AS DECIMAL ( 10, 0 )) + 1 ), '-01' ) USING utf8mb4 )) THEN
				0 ELSE 1
				END
				) ELSE 1
				END
				)) AS `JANUARY`,
				sum((
				CASE

				WHEN ( `tmp`.`TIME` IS NOT NULL ) THEN
				(
				CASE

				WHEN (
				date_format( `tmp`.`TIME`, '%Y-%m' ) &lt; CONVERT ( concat(( cast( `tmp`.`yaer` AS DECIMAL ( 10, 0 )) + 1 ), '-02' ) USING utf8mb4 )) THEN
				0 ELSE 1
				END
				) ELSE 1
				END
				)) AS `FEBRUARY`,
				sum((
				CASE

				WHEN ( `tmp`.`TIME` IS NOT NULL ) THEN
				(
				CASE

				WHEN (
				date_format( `tmp`.`TIME`, '%Y-%m' ) &lt; CONVERT ( concat(( cast( `tmp`.`yaer` AS DECIMAL ( 10, 0 )) + 1 ), '-03' ) USING utf8mb4 )) THEN
				0 ELSE 1
				END
				) ELSE 1
				END
				)) AS `MARCH`
				FROM
				(
				SELECT
				'' AS `GROUP_ID`,
				`e`.`SUPPLIERNAME` AS `SUPPLIERNAME`,(
				CASE

				WHEN ( date_format( now(), '%m' ) &lt; '04' ) THEN
				( cast( date_format( now(), '%Y' ) AS signed ) - 1 ) ELSE date_format( now(), '%Y' )
				END
				) AS `yaer`,
				`e`.`ACCOUNT` AS `ACCOUNT`,
				`e`.`EXITIME` AS `TIME`
				FROM
				`expatriatesinfor` `e`
				WHERE
				((
				`e`.`OPERATIONFORM` = 'BP024001'
				)
				AND ( `e`.`EXITS` = '1' )) UNION
				SELECT
				'' AS `GROUP_ID`,
				`e`.`SUPPLIERNAME` AS `SUPPLIERNAME`,(
				CASE

				WHEN ( date_format( now(), '%m' ) &lt; '04' ) THEN
				( cast( date_format( now(), '%Y' ) AS signed ) - 1 ) ELSE date_format( now(), '%Y' )
				END
				) AS `yaer`,
				`e`.`ACCOUNT` AS `ACCOUNT`,
				`e`.`EXITIME` AS `TIME`
				FROM
				`expatriatesinfor` `e`
				WHERE
				((
				`e`.`OPERATIONFORM` = 'BP024001'
				)
				AND ( `e`.`EXITS` = '0' ))) `tmp`
				GROUP BY
				`tmp`.`GROUP_ID`,
				`tmp`.`SUPPLIERNAME`,
				`tmp`.`yaer`
				ORDER BY
				`tmp`.`SUPPLIERNAME` DESC
				) `t`
			)
			bpsum3_1
			where
			year = #{years}
			order by
			year
		</if>

	</select>

	<select id="getbpsum2" resultType="com.nt.dao_Pfans.PFANS6000.Vo.bpSum2Vo">
		select
		<if test="groupid!=null and groupid !=''">
			*
		</if>
		<if test="groupid ==null || groupid ==''">
			SUPPLIERNAME,
			sum(CONVERT(JANUARYGN,DECIMAL(10,2))) as JANUARYGN, sum(CONVERT(FEBRUARYGN,DECIMAL(10,2))) as FEBRUARYGN,
			sum(CONVERT(MARCHGN,DECIMAL(10,2))) as MARCHGN, sum(CONVERT(APRILGN,DECIMAL(10,2))) as APRILGN, sum(CONVERT(MAYGN,DECIMAL(10,2))) as MAYGN, sum(CONVERT(JUNEGN,DECIMAL(10,2))) as JUNEGN,
			sum(CONVERT(JULYGN,DECIMAL(10,2))) as JULYGN, sum(CONVERT(AUGUSTGN,DECIMAL(10,2))) as AUGUSTGN, sum(CONVERT(SEPTEMBERGN,DECIMAL(10,2))) as SEPTEMBERGN, sum(CONVERT(OCTOBERGN,DECIMAL(10,2))) as OCTOBERGN,
			sum(CONVERT(NOVEMBERGN,DECIMAL(10,2))) as NOVEMBERGN, sum(CONVERT(DECEMBERGN,DECIMAL(10,2))) as DECEMBERGN
			,
			sum(CONVERT(JANUARYGW,DECIMAL(10,2))) as JANUARYGW, sum(CONVERT(FEBRUARYGW,DECIMAL(10,2))) as FEBRUARYGW,
			sum(CONVERT(MARCHGW,DECIMAL(10,2))) as MARCHGW, sum(CONVERT(APRILGW,DECIMAL(10,2))) as APRILGW, sum(CONVERT(MAYGW,DECIMAL(10,2))) as MAYGW, sum(CONVERT(JUNEGW,DECIMAL(10,2))) as JUNEGW,
			sum(CONVERT(JULYGW,DECIMAL(10,2))) as JULYGW, sum(CONVERT(AUGUSTGW,DECIMAL(10,2))) as AUGUSTGW, sum(CONVERT(SEPTEMBERGW,DECIMAL(10,2))) as SEPTEMBERGW, sum(CONVERT(OCTOBERGW,DECIMAL(10,2))) as OCTOBERGW,
			sum(CONVERT(NOVEMBERGW,DECIMAL(10,2))) as NOVEMBERGW, sum(CONVERT(DECEMBERGW,DECIMAL(10,2))) as DECEMBERGW
		</if>
		from
		(
			SELECT
				`tmp`.`GROUP_ID` AS `GROUP_ID`,
				`tmp`.`BPCOMPANY` AS `SUPPLIERNAME`,
				`tmp`.`YEAR` AS `YEAR`,
				cast(sum( `tmp`.`MANHOUR4` ) AS DECIMAL ( 15, 2 ))  AS `APRILGN`,
				cast(sum( `tmp`.`MANHOUR5` ) AS DECIMAL ( 15, 2 ))  AS `MAYGN`,
				cast(sum( `tmp`.`MANHOUR6` ) AS DECIMAL ( 15, 2 ))  AS `JUNEGN`,
				cast(sum( `tmp`.`MANHOUR7` ) AS DECIMAL ( 15, 2 ))  AS `JULYGN`,
				cast(sum( `tmp`.`MANHOUR8` ) AS DECIMAL ( 15, 2 ))  AS `AUGUSTGN`,
				cast(sum( `tmp`.`MANHOUR9` ) AS DECIMAL ( 15, 2 ))  AS `SEPTEMBERGN`,
				cast(sum( `tmp`.`MANHOUR10` ) AS DECIMAL ( 15, 2 ))  AS `OCTOBERGN`,
				cast(sum( `tmp`.`MANHOUR11` ) AS DECIMAL ( 15, 2 ))  AS `NOVEMBERGN`,
				cast(sum( `tmp`.`MANHOUR12` ) AS DECIMAL ( 15, 2 ))  AS `DECEMBERGN`,
				cast(sum( `tmp`.`MANHOUR1` ) AS DECIMAL ( 15, 2 ))  AS `JANUARYGN`,
				cast(sum( `tmp`.`MANHOUR2` ) AS DECIMAL ( 15, 2 ))  AS `FEBRUARYGN`,
				cast(sum( `tmp`.`MANHOUR3` ) AS DECIMAL ( 15, 2 ))  AS `MARCHGN`,

				cast(sum( `tmp`.`MANHOUR4F` ) AS DECIMAL ( 15, 2 ))  AS `APRILGW`,
				cast(sum( `tmp`.`MANHOUR5F` ) AS DECIMAL ( 15, 2 ))  AS `MAYGW`,
				cast(sum( `tmp`.`MANHOUR6F` ) AS DECIMAL ( 15, 2 ))  AS `JUNEGW`,
				cast(sum( `tmp`.`MANHOUR7F` ) AS DECIMAL ( 15, 2 ))  AS `JULYGW`,
				cast(sum( `tmp`.`MANHOUR8F` ) AS DECIMAL ( 15, 2 ))  AS `AUGUSTGW`,
				cast(sum( `tmp`.`MANHOUR9F` ) AS DECIMAL ( 15, 2 ))  AS `SEPTEMBERGW`,
				cast(sum( `tmp`.`MANHOUR10F`) AS DECIMAL ( 15, 2 ))  AS  `OCTOBERGW`,
				cast(sum( `tmp`.`MANHOUR11F`) AS DECIMAL ( 15, 2 ))  AS  `NOVEMBERGW`,
				cast(sum( `tmp`.`MANHOUR12F`) AS DECIMAL ( 15, 2 ))  AS  `DECEMBERGW`,
				cast(sum( `tmp`.`MANHOUR1F` ) AS DECIMAL ( 15, 2 ))  AS `JANUARYGW`,
				cast(sum( `tmp`.`MANHOUR2F` ) AS DECIMAL ( 15, 2 ))  AS `FEBRUARYGW`,
				cast(sum( `tmp`.`MANHOUR3F` ) AS DECIMAL ( 15, 2 ))  AS `MARCHGW`

			FROM
				companystatistics tmp
			WHERE
				`tmp`.year = #{years}
				<if test="groupid!=null and groupid !=''">
					and `tmp`.GROUP_ID= #{groupid}
				</if>
			GROUP BY
				`tmp`.`YEAR`,
				`tmp`.`GROUP_ID`,
				`tmp`.`BPCOMPANY`
		)
		bpsum2
		where
		year = #{years}
		<if test="groupid!=null and groupid !=''">
			and GROUP_ID= #{groupid}
		</if>
		<if test="groupid == null || groupid ==''">
			group by SUPPLIERNAME
		</if>
		order by
		year
	</select>

	<insert id="insertAll" parameterType="java.util.List">
		insert into companystatistics
		(COMPANYSTATISTICS_ID,YEAR,GROUP_ID,BPCOMPANYID,BPCOMPANY,
		MANHOUR4,COST4,MANHOUR4F,COST4F,
		MANHOUR5,COST5,MANHOUR5F,COST5F,
		MANHOUR6,COST6,MANHOUR6F,COST6F,

		MANHOUR7,COST7,MANHOUR7F,COST7F,
		MANHOUR8,COST8,MANHOUR8F,COST8F,
		MANHOUR9,COST9,MANHOUR9F,COST9F,

		MANHOUR10,COST10,MANHOUR10F,COST10F,
		MANHOUR11,COST11,MANHOUR11F,COST11F,
		MANHOUR12,COST12,MANHOUR12F,COST12F,

		MANHOUR1,COST1,MANHOUR1F,COST1F,
		MANHOUR2,COST2,MANHOUR2F,COST2F,
		MANHOUR3,COST3,MANHOUR3F,COST3F,

		TOTALMANHOUR,TOTALCOST,TOTALMANHOURF,TOTALCOSTF,

		CREATEBY,CREATEON,MODIFYBY,MODIFYON,OWNER,STATUS,TENANTID)
		values
		<foreach item="item" collection="list" separator=",">
			(#{item.companystatistics_id},#{item.year},#{item.group_id},#{item.bpcompanyid},#{item.bpcompany},
			#{item.manhour4},#{item.cost4},   #{item.manhour4f},#{item.cost4f},
			#{item.manhour5},#{item.cost5},   #{item.manhour5f},#{item.cost5f},
			#{item.manhour6},#{item.cost6},   #{item.manhour6f},#{item.cost6f},

			#{item.manhour7},#{item.cost7},   #{item.manhour7f},#{item.cost7f},
			#{item.manhour8},#{item.cost8},   #{item.manhour8f},#{item.cost8f},
			#{item.manhour9},#{item.cost9},   #{item.manhour9f},#{item.cost9f},

			#{item.manhour10},#{item.cost10}, #{item.manhour10f},#{item.cost10f},
			#{item.manhour11},#{item.cost11}, #{item.manhour11f},#{item.cost11f},
			#{item.manhour12},#{item.cost12}, #{item.manhour12f},#{item.cost12f},

			#{item.manhour1},#{item.cost1},   #{item.manhour1f},#{item.cost1f},
			#{item.manhour2},#{item.cost2},   #{item.manhour2f},#{item.cost2f},
			#{item.manhour3},#{item.cost3},   #{item.manhour3f},#{item.cost3f},

			#{item.totalmanhour},#{item.totalcost},#{item.totalmanhourf},#{item.totalcostf},

			#{item.createby},
			#{item.createon},
			#{item.modifyby},
			#{item.modifyon},
			#{item.owner},
			#{item.status},
			#{item.tenantid})
		</foreach>
	</insert>

	<update id="updateAll" parameterType="java.util.List">
		<foreach item="item" collection="list" index="index">
			UPDATE companystatistics
			SET
			YEAR = #{item.year} , GROUP_ID = #{item.group_id} , BPCOMPANYID = #{item.bpcompanyid} , BPCOMPANY = #{item.bpcompany},
			MANHOUR4 = #{item.manhour4},
			COST4 = #{item.cost4},
			MANHOUR4F = #{item.manhour4f},
			COST4F = #{item.cost4f},

			MANHOUR5 = #{item.manhour5},
			COST5 = #{item.cost5},
			MANHOUR5F = #{item.manhour5f},
			COST5F = #{item.cost5f},

			MANHOUR6 = #{item.manhour6},
			COST6 = #{item.cost6},
			MANHOUR6F = #{item.manhour6f},
			COST6F = #{item.cost6f},

			MANHOUR7 = #{item.manhour7},
			COST7 = #{item.cost7},
			MANHOUR7F = #{item.manhour7f},
			COST7F = #{item.cost7f},

			MANHOUR8 = #{item.manhour8},
			COST8 = #{item.cost8},
			MANHOUR8F = #{item.manhour8f},
			COST8F = #{item.cost8f},

			MANHOUR9 = #{item.manhour9},
			COST9 = #{item.cost9},
			MANHOUR9F = #{item.manhour9f},
			COST9F = #{item.cost9f},

			MANHOUR10 = #{item.manhour10},
			COST10 = #{item.cost10},
			MANHOUR10F = #{item.manhour10f},
			COST10F = #{item.cost10f},

			MANHOUR11 = #{item.manhour11},
			COST11 = #{item.cost11},
			MANHOUR11F = #{item.manhour11f},
			COST11F = #{item.cost11f},

			MANHOUR12 = #{item.manhour12},
			COST12 = #{item.cost12},
			MANHOUR12F = #{item.manhour12f},
			COST12F = #{item.cost12f},

			MANHOUR1 = #{item.manhour1},
			COST1 = #{item.cost1},
			MANHOUR1F = #{item.manhour1f},
			COST1F = #{item.cost1f},

			MANHOUR2 = #{item.manhour2},
			COST2 = #{item.cost2},
			MANHOUR2F = #{item.manhour2f},
			COST2F = #{item.cost2f},

			MANHOUR3 = #{item.manhour3},
			COST3 = #{item.cost3},
			MANHOUR3F = #{item.manhour3f},
			COST3F = #{item.cost3f},

			TOTALMANHOUR = #{item.totalmanhour},
			TOTALCOST = #{item.totalcost},
			TOTALMANHOURF = #{item.totalmanhourf},
			TOTALCOSTF = #{item.totalcostf},


			CREATEBY = #{item.createby},
			CREATEON = #{item.createon},
			MODIFYBY = #{item.modifyby},
			MODIFYON = #{item.modifyon},
			OWNER = #{item.owner},
			STATUS = #{item.status},
			TENANTID = #{item.tenantid}
			WHERE COMPANYSTATISTICS_ID = #{item.companystatistics_id};
		</foreach>
	</update>

	<select id="getCompanyList"  resultType="com.nt.dao_Pfans.PFANS6000.CompanyStatistics">
        SELECT
            BPCOMPANY
        FROM
            companystatistics
        WHERE
            YEAR = #{years}
        GROUP BY
            BPCOMPANY
        ORDER BY
            BPCOMPANY
    </select>

	<select id="getcompanyStatisticsList"  resultType="com.nt.dao_Pfans.PFANS6000.CompanyStatistics">
        SELECT
            BPCOMPANY,
            SUM( CASE `GROUP_ID` WHEN #{groupid} THEN IFNULL(${strColumn[0]},0) ELSE 0 END ) AS MANHOUR4,
            SUM( CASE `GROUP_ID` WHEN #{groupid} THEN IFNULL(${strColumn[1]},0) ELSE 0 END ) AS COST4,
            SUM( CASE `GROUP_ID` WHEN #{groupid} THEN IFNULL(${strColumn[2]},0) ELSE 0 END ) AS MANHOUR4F,
            SUM( CASE `GROUP_ID` WHEN #{groupid} THEN IFNULL(${strColumn[3]},0) ELSE 0 END ) AS COST4F
        FROM
            companystatistics
        WHERE YEAR = #{years}
        GROUP BY
            BPCOMPANY UNION ALL
        SELECT
            '合计' ,
            SUM( CASE `GROUP_ID` WHEN #{groupid} THEN IFNULL(${strColumn[0]},0) ELSE 0 END ) AS MANHOUR4,
            SUM( CASE `GROUP_ID` WHEN #{groupid} THEN IFNULL(${strColumn[1]},0) ELSE 0 END ) AS COST4,
            SUM( CASE `GROUP_ID` WHEN #{groupid} THEN IFNULL(${strColumn[2]},0) ELSE 0 END ) AS MANHOUR4F,
            SUM( CASE `GROUP_ID` WHEN #{groupid} THEN IFNULL(${strColumn[3]},0) ELSE 0 END ) AS COST4F
        FROM
            companystatistics
        WHERE YEAR = #{years}
    </select>

	<select id="selectAllcompany"  resultType="com.nt.dao_Pfans.PFANS6000.CompanyStatistics">
        SELECT
			c.YEAR,
			SUM(c.MANHOUR4)   AS MANHOUR4,
			SUM(c.COST4)      AS COST4,
			SUM(c.MANHOUR4F)  AS MANHOUR4F,
			SUM(c.COST4F)     AS COST4F,

			SUM(c.MANHOUR5)   AS MANHOUR5,
			SUM(c.COST5)      AS COST5,
			SUM(c.MANHOUR5F)  AS MANHOUR5F,
			SUM(c.COST5F)     AS COST5F,

			SUM(c.MANHOUR6)   AS MANHOUR6,
			SUM(c.COST6)      AS COST6,
			SUM(c.MANHOUR6F)  AS MANHOUR6F,
			SUM(c.COST6F)     AS COST6F,

			SUM(c.MANHOUR7)   AS MANHOUR7,
			SUM(c.COST7)      AS COST7,
			SUM(c.MANHOUR7F)  AS MANHOUR7F,
			SUM(c.COST7F)     AS COST7F,

			SUM(c.MANHOUR8)   AS MANHOUR8,
			SUM(c.COST8)      AS COST8,
			SUM(c.MANHOUR8F)  AS MANHOUR8F,
			SUM(c.COST8F)     AS COST8F,

			SUM(c.MANHOUR9)   AS MANHOUR9,
			SUM(c.COST9)      AS COST9,
			SUM(c.MANHOUR9F)  AS MANHOUR9F,
			SUM(c.COST9F)     AS COST9F,

			SUM(c.MANHOUR10)  AS MANHOUR10,
			SUM(c.COST10)     AS COST10,
			SUM(c.MANHOUR10F) AS MANHOUR10F,
			SUM(c.COST10F)    AS COST10F,

			SUM(c.MANHOUR11)  AS MANHOUR11,
			SUM(c.COST11)     AS COST11,
			SUM(c.MANHOUR11F) AS MANHOUR11F,
			SUM(c.COST11F)    AS COST11F,

			SUM(c.MANHOUR12)  AS MANHOUR12,
			SUM(c.COST12)     AS COST12,
			SUM(c.MANHOUR12F) AS MANHOUR12F,
			SUM(c.COST12F)    AS COST12F,

			SUM(c.MANHOUR1)   AS MANHOUR1,
			SUM(c.COST1)      AS COST1,
			SUM(c.MANHOUR1F)  AS MANHOUR1F,
			SUM(c.COST1F)     AS COST1F,

			SUM(c.MANHOUR2)   AS MANHOUR2,
			SUM(c.COST2)      AS COST2,
			SUM(c.MANHOUR2F)  AS MANHOUR2F,
			SUM(c.COST2F)     AS COST2F,

			SUM(c.MANHOUR3)   AS MANHOUR3,
			SUM(c.COST3)      AS COST3,
			SUM(c.MANHOUR3F)  AS MANHOUR3F,
			SUM(c.COST3F)     AS COST3F,

			SUM(c.TOTALMANHOUR)   AS TOTALMANHOUR,
			SUM(c.TOTALCOST)      AS TOTALCOST,
			SUM(c.TOTALMANHOURF)  AS TOTALMANHOURF,
			SUM(c.TOTALCOSTF)     AS TOTALCOSTF,

			c.BPCOMPANYID,
			c.BPCOMPANY

			FROM companystatistics c
			WHERE c.YEAR = #{years}
			GROUP BY c.YEAR,c.BPCOMPANYID,c.BPCOMPANY
    </select>

</mapper>
