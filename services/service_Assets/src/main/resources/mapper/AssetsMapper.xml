<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.nt.service_Assets.mapper.AssetsMapper" >
    <select id="getMaxCode" resultType="String">
        SELECT
            CONCAT(TMP.REVAL,
                   CASE WHEN #{Asstype} = 'PA001002' THEN
                            LPAD(REPLACE(IFNULL(TMP.BARCODE,0),TMP.REVAL,'') + 1,5,'0')
                        WHEN #{Asstype} = 'PA001005' OR #{Asstype} = 'PA001006' OR #{Asstype} = 'PA001007' OR #{Asstype} = 'PA001008'  THEN
                            LPAD(REPLACE(IFNULL(TMP.BARCODE,0),TMP.REVAL,'') + 1,4,'0')
                        ELSE
                                REPLACE(IFNULL(TMP.BARCODE,(SELECT value3 FROM dictionary WHERE CODE = #{Asstype})),TMP.REVAL,'') + 1
                       END)
        FROM
            (SELECT
                 CASE WHEN #{Asstype} = 'PA001001' OR #{Asstype} = 'PA001002' OR #{Asstype} = 'PA001003' OR #{Asstype} = 'PA001004' THEN
                              (SELECT value2 FROM dictionary WHERE CODE = #{Asstype})
                      ELSE
                          CONCAT( (SELECT value2 FROM dictionary WHERE CODE = #{Asstype}), (SELECT value2 FROM dictionary WHERE CODE = #{Bartype}))
                     END REVAL,
                 MAX(BARCODE) BARCODE
             FROM
                 assets
             inner join (
             	select CASE WHEN #{Asstype} = 'PA001001' OR #{Asstype} = 'PA001002' OR #{Asstype} = 'PA001003' OR #{Asstype} = 'PA001004' THEN
                              (SELECT value2 FROM dictionary WHERE CODE = #{Asstype})
                      ELSE
                          CONCAT( (SELECT value2 FROM dictionary WHERE CODE = #{Asstype}), (SELECT value2 FROM dictionary WHERE CODE = #{Bartype}))
                     END REVAL
                FROM dual
             ) T
             on assets.barcode like concat(T.REVAL, '%')
             WHERE
                 TYPEASSETS = #{Asstype}
            ) TMP
    </select>

    <select id="selectList4Show" parameterType="com.nt.dao_Assets.Assets" resultType="com.nt.dao_Assets.Assets">
        SELECT
          *
        FROM
          assets
        where
          1=1
        <if test="owners != null and owners.size() > 0 ">
            AND OWNER in
            <foreach item="item" index="index" collection="owners" open="(" separator="," close=")">
        　　　　#{item}
        　　</foreach>
        </if>
    </select>

    <select id="getDepartment" resultType="String">
        SELECT
        DISTINCT ifnull(USEDEPARTMENT,'') USEDEPARTMENT
        FROM
        assets
        where
        1=1
        <if test="owners != null and owners.size() > 0 ">
            AND OWNER in
            <foreach item="item" index="index" collection="owners" open="(" separator="," close=")">
                　　　　#{item}
                　　</foreach>
        </if>
    </select>

    <select id="listByCondition" parameterType="com.nt.dao_Assets.Assets" resultType="com.nt.dao_Assets.Assets">
        SELECT
        *
        FROM
        assets
        <where>
            <if test="filename != null and filename != ''">
                and filename like CONCAT('%',#{filename},'%')
            </if>
            <if test="barcode != null and barcode != ''">
                and barcode like CONCAT('%',#{barcode},'%')
            </if>
            <if test="storagelocation != null and storagelocation != ''">
                and storagelocation like CONCAT('%',#{storagelocation},'%')
            </if>
            <if test="pcno != null and pcno != ''">
                and pcno like CONCAT('%',#{pcno},'%')
            </if>
            <if test="typeassets != null and typeassets != ''">
                and typeassets = #{typeassets}
            </if>
            <if test="usedepartment != null">
                and usedepartment = #{usedepartment}
            </if>
            <if test="principal != null and principal != ''">
                and principal = #{principal}
            </if>
            <if test="stockstatus != null and stockstatus != ''">
                and stockstatus = #{stockstatus}
            </if>
        </where>
    </select>

</mapper>
