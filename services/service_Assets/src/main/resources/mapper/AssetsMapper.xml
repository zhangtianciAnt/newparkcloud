<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.nt.service_Assets.mapper.AssetsMapper" >
    <select id="getMaxCode" resultType="String">
        SELECT
            CONCAT(TMP.REVAL,
                   CASE WHEN #{Asstype} = 'PA001002' THEN
                            LPAD(REPLACE(IFNULL(TMP.BARCODE,0),TMP.REVAL,'') + 1,5,'0')
                        WHEN #{Asstype} = 'PA001005' OR #{Asstype} = 'PA001006' OR #{Asstype} = 'PA001007' OR #{Asstype} = 'PA001008'  THEN
                            LPAD(REPLACE(IFNULL(TMP.BARCODE,0),TMP.REVAL,'') + 1,4,'0')
                        ELSE
                                REPLACE(IFNULL(TMP.BARCODE,(SELECT value3 FROM dictionary WHERE CODE = #{Asstype})),TMP.REVAL,'') + 1
                       END)
        FROM
            (SELECT
                 CASE WHEN #{Asstype} = 'PA001001' OR #{Asstype} = 'PA001002' OR #{Asstype} = 'PA001003' OR #{Asstype} = 'PA001004' THEN
                              (SELECT value2 FROM dictionary WHERE CODE = #{Asstype})
                      ELSE
                          CONCAT( (SELECT value2 FROM dictionary WHERE CODE = #{Asstype}), (SELECT value2 FROM dictionary WHERE CODE = #{Bartype}))
                     END REVAL,
                 MAX(BARCODE) BARCODE
             FROM
                 assets
             WHERE
                 TYPEASSETS = #{Asstype}
            ) TMP
    </select>
</mapper>
