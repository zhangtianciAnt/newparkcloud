<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.nt.service_BASF.mapper.ApplicationMapper">
    <resultMap id="BaseResultMap" type="com.nt.dao_BASF.Application">
        <!--
          WARNING - @mbg.generated
        -->
        <id column="applicationid" property="applicationid" jdbcType="VARCHAR"/>
        <result column="applicationtype" property="applicationtype" jdbcType="VARCHAR"/>
        <result column="specificlocation" property="specificlocation" jdbcType="VARCHAR"/>
        <result column="applicationdevice" property="applicationdevice" jdbcType="VARCHAR"/>
        <result column="applicationtime" property="applicationtime" jdbcType="VARCHAR"/>
        <result column="returntime" property="returntime" jdbcType="VARCHAR"/>
        <result column="customername" property="customername" jdbcType="VARCHAR"/>
        <result column="applicationstatus" property="applicationstatus" jdbcType="VARCHAR"/>
        <result column="workcontent" property="workcontent" jdbcType="VARCHAR"/>
        <!--        <result column="devicename" property="devicename" jdbcType="VARCHAR"/>-->
        <!--        <result column="deviceinformationid" property="deviceinformationid" jdbcType="VARCHAR"/>-->
        <!--        <result column="region" property="region" jdbcType="VARCHAR"/>-->
        <!--        <result column="device" property="device" jdbcType="VARCHAR"/>-->
        <!--        <result column="floor" property="floor" jdbcType="VARCHAR"/>-->
        <result column="STATUS" property="status" jdbcType="VARCHAR"/>
        <result column="CREATEON" property="createon" jdbcType="TIMESTAMP"/>
        <result column="CREATEBY" property="createby" jdbcType="VARCHAR"/>
        <result column="MODIFYON" property="modifyon" jdbcType="TIMESTAMP"/>
        <result column="MODIFYBY" property="modifyby" jdbcType="VARCHAR"/>
        <result column="Owner" property="owner" jdbcType="VARCHAR"/>
        <result column="TENANTID" property="tenantid" jdbcType="VARCHAR"/>
        <result column="devicestatus" property="devicestatus" jdbcType="VARCHAR"/>
    </resultMap>


    <sql id="selectApplicationVo">
		SELECT
		ap.applicationid,
		ap.customername,
		ap.applicationstatus,
		ap.workcontent,
		ap.deviceinformationid,
		ap.region,
		ap.device,
		ap.floor,
		ap.status,
		ap.createon,
		ap.createby,
        dev.devicename
		FROM
		application ap
		LEFT JOIN
		deviceinformation dev
		ON ap.deviceinformationid =
		dev.deviceinformationid
		where ap.status='0'
	</sql>

    <select id="selectApplicationVoList" resultType="com.nt.dao_BASF.VO.ApplicationVo">
        <include refid="selectApplicationVo"></include>
    </select>

    <select id="selectBarricades" resultType="com.nt.dao_BASF.Application">
        SELECT
        a.deviceinformationid
        FROM
        application AS a
        WHERE
        a.applicationtype = "03702" AND
        a.applicationstatus = "BC012002" AND
        a.applicationtime &lt;= CURDATE() AND
        a.returntime &gt;= CURDATE()
    </select>


    <select id="roadClosed" resultType="com.nt.dao_BASF.Application">
SELECT
	*
FROM
	application AS a
WHERE
	a.`STATUS` = '0'
	AND a.applicationstatus = 'BC012002'
	AND a.applicationtype = '03702'
	AND DATEDIFF(a.returntime,CURRENT_DATE ())>=0
	AND DATEDIFF(CURRENT_DATE (),a.applicationtime)>=0
    </select>

    <select id="getAllInfo" resultType="com.nt.dao_BASF.Application">
        select
        application.*,
        (select VALUE1 from dictionary where `CODE`=deviceinformation.devicestatus) as devicestatus
        from application application
        LEFT JOIN deviceinformation deviceinformation ON deviceinformation.deviceinformationid =
        application.deviceinformationid
        where application.`STATUS`='0'
        <if test="applicationtype != null">
            and applicationtype=#{applicationtype}
        </if>
    </select>

    <select id="getAllReturnBack" resultType="com.nt.dao_BASF.Application">
        SELECT * FROM application
        WHERE
        ifnull(`STATUS`,'0') = '0'
        and DATEDIFF(CURRENT_DATE (),returntime)>=0
    </select>

    <select id="getAllByDeviceInformationId" resultType="com.nt.dao_BASF.Application">
        SELECT * FROM application
        WHERE
            deviceinformationid like CONCAT('%', #{deviceinformationid, jdbcType=VARCHAR}, '%')
    </select>
</mapper>

